<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏≥‡πÄ‡∏•‡πá‡∏ö | GY - Nail Booking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&family=Fredoka:wght@500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        rose: { 50: '#fff1f2', 100: '#ffe4e6', 200: '#fecdd3', 300: '#fda4af', 400: '#fb7185', 500: '#f43f5e', 600: '#e11d48', 900: '#881337' }
                    },
                    fontFamily: { sans: ['Prompt', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        body { background-color: #fff1f2; background-image: radial-gradient(#ffe4e6 1px, transparent 1px); background-size: 20px 20px; padding-bottom: 80px; }
        .glass-panel { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.5); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        input[type="radio"]:checked + div, input[type="radio"]:checked + label { border-color: #f43f5e; background-color: #fff1f2; color: #e11d48; box-shadow: 0 4px 6px -1px rgba(244, 63, 94, 0.1); }
        input[type="radio"]:checked + label { transform: scale(0.98); }
        input[type="checkbox"]:checked + div { border-color: #f43f5e; background-color: #fff1f2; color: #e11d48; }
        input[type="checkbox"]:checked + div .check-icon { display: block; }
        .time-btn.active { background-color: #f43f5e; color: white; border-color: #f43f5e; box-shadow: 0 4px 6px -1px rgba(244, 63, 94, 0.3); }
        .price-tag { background-color: #ffe4e6; color: #e11d48; padding: 2px 8px; border-radius: 10px; font-size: 0.75rem; font-weight: 600; margin-top: 4px; }
        @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
        .price-pop { animation: pop 0.3s ease-in-out; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
        .tab-btn { flex: 1; padding-top: 0.75rem; padding-bottom: 0.75rem; text-align: center; color: #fecdd3; cursor: pointer; border-bottom: 4px solid transparent; transition: all; }
        .tab-btn:hover { color: white; }
        .tab-btn.active { color: white; border-color: white; font-weight: 700; background-color: rgba(255,255,255,0.1); border-top-left-radius: 0.5rem; border-top-right-radius: 0.5rem; }
        .cat-tab { padding-left: 1rem; padding-right: 1rem; padding-top: 0.5rem; padding-bottom: 0.5rem; border-radius: 9999px; font-size: 0.75rem; cursor: pointer; border: 1px solid #e5e7eb; color: #6b7280; white-space: nowrap; }
        .cat-tab.active { background-color: #f43f5e; color: white; border-color: #f43f5e; font-weight: 700; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .loading-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.8); z-index:9999; display:flex; justify-content:center; align-items:center; backdrop-filter: blur(2px); }
        .custom-img { width: 100%; height: 100%; object-fit: cover; border-radius: 6px; }
        @media (min-width: 768px) {
            #page-booking form .glass-panel { max-width: 100%; }
            #page-booking .grid.grid-cols-2 { grid-template-columns: repeat(3, 1fr); }
            #slotsContainer { grid-template-columns: repeat(4, 1fr); }
        }
        @media (min-width: 1024px) {
            #page-booking form .glass-panel { max-width: 100%; }
            #page-booking .grid.grid-cols-2 { grid-template-columns: repeat(4, 1fr); }
            #slotsContainer { grid-template-columns: repeat(6, 1fr); }
        }
        #ai-bubble { touch-action: none; transition: none; }
        #ai-bubble.snapping { transition: left 0.3s ease, right 0.3s ease, bottom 0.3s ease; }
        @keyframes aiBounce { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-6px)} }
        @keyframes marquee { 0%{transform:translateX(100%)} 100%{transform:translateX(-100%)} }
        .animate-marquee { animation: marquee 8s linear infinite; white-space: nowrap; }
        #ai-bubble:not(.dragging) > div:first-child { animation: aiBounce 3s ease-in-out infinite; }
        @keyframes contactPop { from { opacity: 0; transform: scale(0) translateY(20px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        #contact-bubble > div:first-child { animation: aiBounce 3s ease-in-out 1.5s infinite; }
    </style>
</head>
<body class="font-sans text-gray-600 min-h-screen flex flex-col">

    <!-- Loading Screen -->
    <div id="loading" class="loading-overlay">
        <div class="text-center p-6 max-w-sm">
            <div id="loader-icon">
                <i class="fas fa-circle-notch fa-spin text-4xl text-rose-500 mb-3"></i>
                <p class="text-rose-400 animate-pulse">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
            </div>
            <div id="loader-error" class="hidden">
                <i class="fas fa-exclamation-circle text-4xl text-red-500 mb-3"></i>
                <p class="text-gray-800 font-bold mb-2">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p>
                <div class="text-gray-600 mb-4 text-xs text-left bg-gray-100 p-3 rounded border">
                    <b>‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:</b><br>
                    1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL ‡πÉ‡∏ô script<br>
                    2. Deploy Google Apps Script ‡πÉ‡∏´‡∏°‡πà<br>
                    3. Refresh ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
                </div>
                <button onclick="location.reload()" class="bg-gray-500 text-white px-6 py-2 rounded-xl shadow hover:bg-gray-600 transition w-full">‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-gradient-to-r from-rose-400 to-rose-500 text-white shadow-lg sticky top-0 z-50 rounded-b-3xl mb-4">
        <div class="max-w-md md:max-w-2xl lg:max-w-4xl mx-auto px-4 sm:px-6 pt-4 pb-2">
            <div class="flex justify-between items-start mb-2">
                <div class="flex items-center space-x-2 flex-1 min-w-0">
                    <div class="bg-white/20 p-2 rounded-full backdrop-blur-sm shrink-0">
                        <i class="fas fa-gem text-lg"></i>
                    </div>
                    <div class="min-w-0">
                        <h1 class="leading-tight" id="shopNameHeader" style="font-family:'Fredoka',sans-serif; font-size:1.5rem; font-weight:700; letter-spacing:2px; text-shadow: 2px 2px 4px rgba(0,0,0,0.15);">GY - NAIL</h1>
                        <p class="text-xs text-rose-100 font-light tracking-wide">‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏≥‡πÄ‡∏•‡πá‡∏ö‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</p>
                    </div>
                </div>
                <div class="flex flex-col items-end gap-1">
                    <div id="shopStatusBadge" class="hidden">
                        <div id="shopStatusOpen" class="hidden px-2 py-1 rounded-lg text-xs font-bold flex items-center gap-1 border border-green-300" style="background: linear-gradient(135deg, #22c55e, #16a34a);">
                            <span class="relative flex h-2 w-2"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-white opacity-75"></span><span class="relative inline-flex rounded-full h-2 w-2 bg-white"></span></span>
                            ‡πÄ‡∏õ‡∏¥‡∏î
                        </div>
                        <div id="shopStatusClosed" class="hidden px-2 py-1 rounded-lg text-xs font-bold flex items-center gap-1 border border-red-300" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                            <i class="fas fa-door-closed text-xs"></i>
                            ‡∏õ‡∏¥‡∏î
                        </div>
                    </div>
                    <div id="marquee-banner" class="hidden overflow-hidden rounded-full bg-white/20 backdrop-blur-sm py-0.5 px-2 w-32">
                        <div class="overflow-hidden whitespace-nowrap">
                            <span class="inline-block animate-marquee text-white text-[10px] font-medium" id="marquee-text"></span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex text-sm font-medium -mx-4 sm:mx-0 border-b border-white/20">
                <div onclick="switchTab('booking')" id="tab-booking" class="tab-btn active">
                    <i class="fas fa-calendar-plus mb-1 block"></i> ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß
                </div>
                <div onclick="switchTab('search')" id="tab-search" class="tab-btn">
                    <i class="fas fa-search mb-1 block"></i> ‡πÄ‡∏ä‡πá‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                </div>
                <div onclick="switchTab('admin')" id="tab-admin" class="tab-btn">
                    <i class="fas fa-store mb-1 block"></i> ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤
                </div>
            </div>
        </div>
    </header>

    <main class="flex-1 max-w-md md:max-w-2xl lg:max-w-4xl mx-auto w-full px-4 pb-24">
        <!-- BOOKING PAGE -->
        <div id="page-booking" class="fade-in">
            <form id="bookingForm" onsubmit="handleBooking(event)">
                <!-- Quick Actions for Customer -->
                <div class="flex gap-2 mb-4">
                    <button type="button" onclick="document.getElementById('reviews-modal').classList.remove('hidden'); loadReviews();" class="flex-1 bg-gradient-to-r from-yellow-400 to-orange-400 text-white py-3 rounded-xl shadow-lg flex items-center justify-center gap-2">
                        <i class="fas fa-star"></i>
                        <span class="font-medium text-sm">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</span>
                    </button>
                    <button type="button" onclick="showPortfolioGallery()" class="flex-1 bg-gradient-to-r from-purple-400 to-pink-400 text-white py-3 rounded-xl shadow-lg flex items-center justify-center gap-2">
                        <i class="fas fa-images"></i>
                        <span class="font-medium text-sm">‡∏ú‡∏•‡∏á‡∏≤‡∏ô</span>
                    </button>
                </div>

                <div class="glass-panel rounded-2xl p-6 shadow-sm">
                    <h2 class="text-rose-600 font-semibold mb-4"><i class="fas fa-hand-sparkles mr-2"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡∏à</h2>
                    <div class="grid grid-cols-2 gap-3" id="service-list-container">
                        <div class="col-span-2 text-center text-gray-300 py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
                    </div>
                </div>

                <div class="glass-panel rounded-2xl p-6 shadow-sm mt-4">
                    <h2 class="text-rose-600 font-semibold mb-2"><i class="fas fa-lightbulb mr-2"></i> ‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡∏•‡∏≤‡∏¢‡πÄ‡∏•‡πá‡∏ö</h2>
                    <div class="grid grid-cols-3 gap-2" id="design-list-container"></div>
                    <div class="mt-3">
                        <label class="block text-sm text-gray-500 mb-1">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
                        <input type="text" id="artInput" name="design" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏Å‡∏±‡∏•‡∏î‡∏µ, ‡∏•‡∏≤‡∏¢‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ" class="w-full bg-white border border-gray-200 py-2 px-4 rounded-xl focus:outline-none focus:border-rose-500 text-sm">
                    </div>
                </div>

                <div class="glass-panel rounded-2xl p-6 shadow-sm mt-4">
                    <h2 class="text-rose-600 font-semibold mb-4"><i class="fas fa-list-ul mr-2"></i> ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏° & ‡∏ó‡∏£‡∏á‡πÄ‡∏•‡πá‡∏ö</h2>
                    <div class="mb-5">
                        <label class="block text-sm text-gray-500 mb-2">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏° (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠)</label>
                        <div class="space-y-2" id="addon-list-container"></div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm text-gray-500 mb-2">‡∏ó‡∏£‡∏á‡πÄ‡∏•‡πá‡∏ö‡∏¢‡∏≠‡∏î‡∏Æ‡∏¥‡∏ï</label>
                        <div class="flex space-x-3 overflow-x-auto no-scrollbar pb-4 pt-1 px-1" id="shape-list-container"></div>
                    </div>
                </div>

                <div class="glass-panel rounded-2xl p-6 shadow-sm mt-4">
                    <h2 class="text-rose-600 font-semibold mb-4"><i class="fas fa-map-marker-alt mr-2"></i> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</h2>
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <label class="cursor-pointer group">
                            <input type="radio" name="locationType" value="‡∏ó‡∏≥‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô" class="location-radio hidden" checked onchange="toggleAddress(false)">
                            <div class="border border-gray-200 rounded-xl p-4 flex flex-col items-center justify-center h-24 transition-all hover:border-rose-300 bg-white text-center">
                                <i class="fas fa-store text-2xl mb-2 text-rose-300"></i>
                                <span class="text-sm font-medium">‡∏ó‡∏≥‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô</span>
                            </div>
                        </label>
                        <label class="cursor-pointer group">
                            <input type="radio" name="locationType" value="‡∏ó‡∏≥‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤" class="location-radio hidden" onchange="toggleAddress(true)">
                            <div class="border border-gray-200 rounded-xl p-4 flex flex-col items-center justify-center h-24 transition-all hover:border-rose-300 bg-white text-center">
                                <i class="fas fa-car text-2xl mb-2 text-rose-300"></i>
                                <span class="text-sm font-medium">‡∏ó‡∏≥‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô</span>
                            </div>
                        </label>
                    </div>
                    <div id="addressField" class="hidden">
                        <label class="block text-sm text-gray-500 mb-1">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà / ‡∏û‡∏¥‡∏Å‡∏±‡∏î</label>
                        <textarea name="address" rows="2" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô ‡∏ã‡∏≠‡∏¢ ‡∏ñ‡∏ô‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∏‡∏î‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï..." class="w-full bg-white border border-gray-200 py-2 px-4 rounded-xl focus:outline-none focus:border-rose-500 text-sm"></textarea>
                    </div>
                </div>

                <div class="glass-panel rounded-2xl p-6 shadow-sm mt-4">
                    <h2 class="text-rose-600 font-semibold mb-4"><i class="far fa-calendar-alt mr-2"></i> ‡∏ß‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤</h2>
                    <div class="mb-4">
                        <input type="date" id="dateInput" name="date" class="w-full text-center bg-white border border-rose-200 text-gray-700 font-medium py-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-rose-400 shadow-sm" required>
                    </div>
                    
                    <div id="queueStatus" class="hidden mb-4 bg-gradient-to-r from-rose-50 to-pink-50 rounded-xl p-4 border border-rose-200">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-bold text-rose-700 text-sm"><i class="fas fa-users mr-2"></i>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏¥‡∏ß‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
                            <span class="text-xs text-rose-500 animate-pulse"><i class="fas fa-sync-alt fa-spin mr-1"></i>‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</span>
                        </div>
                        <div id="queueInfo" class="space-y-2"></div>
                        <div class="mt-3 pt-3 border-t border-rose-200">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß:</span>
                                <span id="bookedCount" class="font-bold text-rose-600">0 ‡∏Ñ‡∏ô</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">‡∏ß‡πà‡∏≤‡∏á:</span>
                                <span id="availableCount" class="font-bold text-green-600">0 ‡∏Ñ‡∏ô</span>
                            </div>
                        </div>
                    </div>
                    
                    <div id="loadingSlots" class="hidden text-center py-4 text-rose-400"><i class="fas fa-circle-notch fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡∏¥‡∏ß‡∏ß‡πà‡∏≤‡∏á...</div>
                    <div id="slotsContainer" class="grid grid-cols-3 gap-2 mb-6">
                        <div class="col-span-3 text-center text-gray-400 text-sm py-4 bg-gray-50 rounded-xl border border-dashed border-gray-200">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡πà‡∏≠‡∏ô</div>
                    </div>
                    <input type="hidden" name="time" id="selectedTimeInput" required>
                    <div class="border-t border-gray-100 pt-4 space-y-3">
                        <div><label class="text-xs text-gray-400 ml-1">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</label><input type="text" name="name" class="w-full bg-white border border-gray-200 py-3 px-4 rounded-xl focus:outline-none focus:border-rose-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô" required></div>
                        <div><label class="text-xs text-gray-400 ml-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label><input type="tel" name="phone" class="w-full bg-white border border-gray-200 py-3 px-4 rounded-xl focus:outline-none focus:border-rose-500" placeholder="0xx-xxx-xxxx" required></div>
                    </div>
                </div>

                <div class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-md border-t border-gray-200 p-4 shadow-lg z-40 rounded-t-2xl">
                    <div class="max-w-md md:max-w-2xl lg:max-w-4xl mx-auto flex items-center justify-between gap-4">
                        <div class="flex flex-col">
                            <span class="text-xs text-gray-400">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</span>
                            <div class="text-xl font-bold text-rose-600 flex items-baseline">
                                <span id="totalPriceDisplay">0</span>
                                <span class="text-sm ml-1 text-gray-500">‡∏ö‡∏≤‡∏ó</span>
                            </div>
                        </div>
                        <button type="submit" id="submitBtn" class="flex-1 bg-gradient-to-r from-rose-500 to-rose-400 hover:from-rose-600 hover:to-rose-500 text-white font-bold py-3 px-6 rounded-xl shadow-lg transform transition active:scale-95 flex justify-center items-center gap-2">
                            <span>‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß</span>
                            <i class="fas fa-chevron-right text-xs"></i>
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <!-- SEARCH PAGE -->
        <div id="page-search" class="hidden fade-in pt-10">
            <div class="glass-panel rounded-2xl p-8 text-center shadow-sm">
                <div class="w-16 h-16 bg-rose-100 rounded-full flex items-center justify-center mx-auto mb-4 text-rose-500 text-2xl">
                    <i class="fas fa-search"></i>
                </div>
                <h2 class="text-xl font-bold text-gray-700 mb-2">‡πÄ‡∏ä‡πá‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</h2>
                <p class="text-gray-400 text-sm mb-6">‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå ‡∏´‡∏£‡∏∑‡∏≠ Order ID</p>
                <div class="relative max-w-xs mx-auto">
                    <input type="text" id="search-key" placeholder="08x-xxx-xxxx" class="w-full bg-white border border-gray-200 py-3 px-4 rounded-xl focus:outline-none focus:border-rose-500 text-center">
                    <button onclick="doSearch()" class="absolute right-2 top-2 bg-rose-500 text-white w-8 h-8 rounded-lg hover:bg-rose-600 transition"><i class="fas fa-arrow-right"></i></button>
                </div>
                <div id="search-result" class="mt-6 hidden text-left space-y-4"></div>
                <div id="search-error" class="mt-4 text-red-400 text-sm hidden">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</div>
            </div>
        </div>

        <!-- ADMIN PAGE (React Powered) -->
        <div id="page-admin" class="hidden fade-in pt-10">
            <div id="admin-root"></div>
        </div>
    </main>

    <!-- Modals -->
    <div id="settings-modal" class="fixed inset-0 bg-black/50 hidden z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-2xl p-5 max-h-[85vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h3 class="font-bold text-lg text-gray-800">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                <button onclick="closeModal('settings-modal')" class="text-gray-400"><i class="fas fa-times"></i></button>
            </div>
            <div id="settings-form" class="space-y-3"></div>
            <button onclick="saveSettings()" class="w-full bg-rose-500 text-white py-2 rounded-xl mt-4 hover:bg-rose-600">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
    </div>

    <div id="shop-schedule-modal" class="fixed inset-0 bg-black/50 hidden z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-md rounded-2xl p-5 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h3 class="font-bold text-lg text-gray-800 flex items-center gap-2"><i class="fas fa-calendar-week text-rose-500"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô</h3>
                <button onclick="closeModal('shop-schedule-modal')" class="text-gray-400"><i class="fas fa-times"></i></button>
            </div>
            <div class="space-y-4">
                <div class="bg-rose-50 p-3 rounded-lg text-sm text-rose-700"><i class="fas fa-info-circle mr-1"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô‡∏õ‡∏¥‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©</div>
                <div>
                    <h4 class="font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ</h4>
                    <div id="specialDatesList" class="space-y-2 max-h-48 overflow-y-auto">
                        <p class="text-gray-400 text-sm text-center py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ</p>
                    </div>
                </div>
                <div class="border-t pt-4">
                    <h4 class="font-medium text-gray-700 mb-3">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©</h4>
                    <div class="space-y-3">
                        <div><label class="text-xs text-gray-500 block mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><input type="date" id="specialDateInput" class="w-full border border-gray-200 rounded-lg px-3 py-2 text-sm"></div>
                        <div><label class="text-xs text-gray-500 block mb-1">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
                            <select id="specialDateStatus" class="w-full border border-gray-200 rounded-lg px-3 py-2 text-sm">
                                <option value="closed">‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô</option>
                                <option value="open">‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô (‡∏û‡∏¥‡πÄ‡∏®‡∏©)</option>
                            </select>
                        </div>
                        <div><label class="text-xs text-gray-500 block mb-1">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label><input type="text" id="specialDateNote" class="w-full border border-gray-200 rounded-lg px-3 py-2 text-sm" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏ô‡∏±‡∏Å‡∏Ç‡∏±‡∏ï‡∏§‡∏Å‡∏©‡πå"></div>
                        <button onclick="addSpecialDate()" class="w-full bg-rose-500 text-white py-2 rounded-lg text-sm hover:bg-rose-600"><i class="fas fa-plus mr-1"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="service-modal" class="fixed inset-0 bg-black/50 hidden z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-md rounded-2xl p-5 max-h-[90vh] flex flex-col h-[600px]">
            <div class="flex justify-between items-center mb-2">
                <h3 class="font-bold text-lg text-gray-800">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π</h3>
                <button onclick="closeServiceManager()" class="text-gray-400"><i class="fas fa-times"></i></button>
            </div>
            <div class="flex gap-2 overflow-x-auto pb-2 no-scrollbar mb-2">
                <button onclick="switchManagerTab('services')" id="mgr-tab-services" class="cat-tab active">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å</button>
                <button onclick="switchManagerTab('designs')" id="mgr-tab-designs" class="cat-tab">‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡∏•‡∏≤‡∏¢‡πÄ‡∏•‡πá‡∏ö</button>
                <button onclick="switchManagerTab('addons')" id="mgr-tab-addons" class="cat-tab">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°</button>
                <button onclick="switchManagerTab('shapes')" id="mgr-tab-shapes" class="cat-tab">‡∏ó‡∏£‡∏á‡πÄ‡∏•‡πá‡∏ö</button>
            </div>
            <div class="overflow-y-auto flex-1 space-y-2 mb-4 p-1" id="admin-service-list"></div>
            <button onclick="openServiceEdit()" class="w-full bg-green-500 text-white py-2 rounded-xl hover:bg-green-600"><i class="fas fa-plus mr-1"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</button>
        </div>
    </div>

    <div id="service-edit-modal" class="fixed inset-0 bg-black/60 hidden z-[60] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-2xl p-5 shadow-2xl">
            <h3 class="font-bold text-lg text-gray-800 mb-4" id="svc-form-title">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</h3>
            <div class="space-y-3">
                <input type="hidden" id="svc-id">
                <div><label class="text-xs text-gray-500 block mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label><input type="text" id="svc-name" class="w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:border-rose-500 outline-none"></div>
                <div id="field-price-container"><label class="text-xs text-gray-500 block mb-1">‡∏£‡∏≤‡∏Ñ‡∏≤ (‡πÉ‡∏™‡πà 0 ‡∏ñ‡πâ‡∏≤‡∏ü‡∏£‡∏µ)</label><input type="number" id="svc-price" class="w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:border-rose-500 outline-none"></div>
                <div id="field-icon-container"><label class="text-xs text-gray-500 block mb-1">‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô / URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label><input type="text" id="svc-icon" class="w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:border-rose-500 outline-none" placeholder="fas fa-star ‡∏´‡∏£‡∏∑‡∏≠ https://..."></div>
            </div>
            <div class="flex gap-2 mt-5">
                <button onclick="closeModal('service-edit-modal')" class="flex-1 bg-gray-200 text-gray-600 py-2 rounded-xl">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button onclick="saveServiceData()" class="flex-1 bg-rose-500 text-white py-2 rounded-xl hover:bg-rose-600">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
        </div>
    </div>

    <div id="customer-modal" class="fixed inset-0 bg-black/50 hidden z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-md rounded-2xl p-5 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h3 class="font-bold text-lg text-gray-800">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3>
                <button onclick="closeModal('customer-modal')" class="text-gray-400"><i class="fas fa-times"></i></button>
            </div>
            <div id="customer-detail-content" class="space-y-4"></div>
        </div>
    </div>

    <div id="reports-modal" class="fixed inset-0 bg-black/50 hidden z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-md rounded-2xl p-5 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h3 class="font-bold text-lg text-gray-800">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</h3>
                <button onclick="closeModal('reports-modal')" class="text-gray-400"><i class="fas fa-times"></i></button>
            </div>
            <div class="space-y-4">
                <div class="flex gap-2">
                    <button onclick="loadRevenueReport('today')" class="flex-1 py-2 text-sm bg-rose-500 text-white rounded-lg">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
                    <button onclick="loadRevenueReport('week')" class="flex-1 py-2 text-sm bg-gray-200 text-gray-700 rounded-lg">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</button>
                    <button onclick="loadRevenueReport('month')" class="flex-1 py-2 text-sm bg-gray-200 text-gray-700 rounded-lg">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
                </div>
                <div id="revenue-chart" class="h-48 bg-gray-50 rounded-lg flex items-center justify-center"><p class="text-gray-400 text-sm">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</p></div>
                <div id="revenue-summary" class="space-y-2"></div>
            </div>
        </div>
    </div>

    <!-- Portfolio Gallery Modal -->
    <div id="portfolio-modal" class="fixed inset-0 bg-black/50 hidden z-[70] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-lg rounded-2xl max-h-[85vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b">
                <h3 class="font-bold text-gray-800"><i class="fas fa-images text-purple-500 mr-2"></i>‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</h3>
                <button onclick="closeModal('portfolio-modal')" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times"></i></button>
            </div>
            <div id="portfolio-upload-section" class="hidden p-4 border-b bg-purple-50">
                <div class="flex gap-2 items-end">
                    <div class="flex-1">
                        <label class="text-xs text-gray-500 mb-1 block">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ</label>
                        <input type="file" id="portfolio-file" accept="image/*" class="w-full text-xs border rounded-lg p-1.5">
                    </div>
                    <div class="flex-1">
                        <label class="text-xs text-gray-500 mb-1 block">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢</label>
                        <input type="text" id="portfolio-caption" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏•‡πá‡∏ö‡πÄ‡∏à‡∏•‡∏•‡∏≤‡∏¢‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ" class="w-full text-sm border rounded-lg px-3 py-1.5">
                    </div>
                </div>
                <div class="flex gap-2 mt-2">
                    <select id="portfolio-category" class="text-sm border rounded-lg px-3 py-1.5 flex-1">
                        <option value="">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
                        <option value="‡πÄ‡∏à‡∏•">‡πÄ‡∏à‡∏•</option>
                        <option value="‡∏≠‡∏∞‡∏Ñ‡∏£‡∏¥‡∏•‡∏¥‡∏Ñ">‡∏≠‡∏∞‡∏Ñ‡∏£‡∏¥‡∏•‡∏¥‡∏Ñ</option>
                        <option value="‡πÄ‡∏û‡πâ‡∏ô‡∏ó‡πå">‡πÄ‡∏û‡πâ‡∏ô‡∏ó‡πå</option>
                        <option value="‡∏ï‡πà‡∏≠‡πÄ‡∏•‡πá‡∏ö">‡∏ï‡πà‡∏≠‡πÄ‡∏•‡πá‡∏ö</option>
                        <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                    </select>
                    <button onclick="uploadPortfolioImage()" id="upload-btn" class="bg-purple-500 text-white px-4 py-1.5 rounded-lg text-sm font-medium hover:bg-purple-600">
                        <i class="fas fa-upload mr-1"></i> ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î
                    </button>
                </div>
            </div>
            <div id="portfolio-grid" class="flex-1 overflow-y-auto p-4">
                <div class="text-center text-gray-400 py-10"><i class="fas fa-circle-notch fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
            </div>
        </div>
    </div>

    <!-- Image Preview Modal -->
    <div id="image-preview-modal" class="fixed inset-0 bg-black/80 hidden z-[90] flex items-center justify-center p-4" onclick="closeModal('image-preview-modal')">
        <img id="preview-image" src="" class="max-w-full max-h-[85vh] rounded-xl shadow-2xl">
    </div>

    <!-- Contact Floating Bubble -->
    <div id="contact-bubble" class="fixed z-[79] select-none" style="bottom:100px;left:20px;">
        <div id="contact-menu" class="hidden absolute bottom-[70px] left-0 flex flex-col-reverse gap-2 sm:gap-3 items-center" style="transform: translateX(-20%);">
            <a id="contact-line" href="#" target="_blank" class="w-10 h-10 sm:w-12 sm:h-12 bg-[#06C755] rounded-full shadow-lg flex items-center justify-center hover:scale-110 transition-transform" style="animation: contactPop 0.3s ease forwards; animation-delay: 0.0s; opacity: 0;">
                <i class="fab fa-line text-white text-lg sm:text-xl"></i>
            </a>
            <a id="contact-facebook" href="#" target="_blank" class="w-10 h-10 sm:w-12 sm:h-12 bg-[#1877F2] rounded-full shadow-lg flex items-center justify-center hover:scale-110 transition-transform" style="animation: contactPop 0.3s ease forwards; animation-delay: 0.08s; opacity: 0;">
                <i class="fab fa-facebook-f text-white text-base sm:text-lg"></i>
            </a>
            <a id="contact-tiktok" href="#" target="_blank" class="w-10 h-10 sm:w-12 sm:h-12 bg-black rounded-full shadow-lg flex items-center justify-center hover:scale-110 transition-transform" style="animation: contactPop 0.3s ease forwards; animation-delay: 0.16s; opacity: 0;">
                <i class="fab fa-tiktok text-white text-base sm:text-lg"></i>
            </a>
            <a id="contact-phone" href="tel:" class="w-10 h-10 sm:w-12 sm:h-12 bg-green-500 rounded-full shadow-lg flex items-center justify-center hover:scale-110 transition-transform" style="animation: contactPop 0.3s ease forwards; animation-delay: 0.24s; opacity: 0;">
                <i class="fas fa-phone-alt text-white text-base sm:text-lg"></i>
            </a>
        </div>
        <div onclick="toggleContactMenu()" class="relative w-12 h-12 sm:w-16 sm:h-16 bg-gradient-to-br from-blue-500 to-cyan-400 rounded-full shadow-xl flex items-center justify-center hover:scale-110 transition-transform cursor-pointer transition-all duration-300" style="transform: rotate(-90deg);">
            <i class="fas fa-headset text-white text-lg sm:text-2xl"></i>
        </div>
        <div class="text-center mt-0.5 sm:mt-1">
            <span class="text-[9px] sm:text-[10px] text-blue-500 font-medium bg-white/80 px-1.5 sm:px-2 py-0.5 rounded-full shadow-sm">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</span>
        </div>
    </div>

    <!-- AI Floating Bubble -->
    <div id="ai-bubble" class="fixed z-[80] cursor-grab active:cursor-grabbing select-none" style="bottom:100px;right:20px;" ontouchstart="aiBubbleTouchStart(event)" ontouchmove="aiBubbleTouchMove(event)" ontouchend="aiBubbleTouchEnd(event)" onmousedown="aiBubbleMouseDown(event)">
        <div onclick="toggleAIChat()" class="relative w-14 h-14 sm:w-16 sm:h-16 bg-gradient-to-br from-rose-500 to-pink-500 rounded-full shadow-xl flex items-center justify-center hover:scale-110 transition-transform">
            <i class="fas fa-robot text-white text-xl sm:text-2xl"></i>
            <div id="ai-badge" class="hidden absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center animate-pulse">
                <span class="text-white text-[10px] font-bold" id="ai-badge-count">0</span>
            </div>
        </div>
        <div class="text-center mt-1">
            <span class="text-[10px] text-rose-500 font-medium bg-white/80 px-2 py-0.5 rounded-full shadow-sm">‡∏ô‡πâ‡∏≠‡∏á‡∏¢‡∏∏‡πâ‡∏¢</span>
        </div>
    </div>

    <!-- AI Chat Panel -->
    <div id="ai-panel" class="fixed z-[81] hidden" style="bottom:170px;right:10px;">
        <div class="bg-white w-[calc(100vw-20px)] max-w-sm sm:w-96 rounded-2xl shadow-2xl flex flex-col border border-rose-100" style="height:min(70vh,500px);">
            <div class="flex justify-between items-center p-3 border-b bg-gradient-to-r from-rose-500 to-pink-500 text-white rounded-t-2xl">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center">
                        <i class="fas fa-robot text-sm"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-sm">‡∏ô‡πâ‡∏≠‡∏á‡∏¢‡∏∏‡πâ‡∏¢‡∏Ñ‡∏ô‡∏™‡∏ß‡∏¢</h3>
                        <p class="text-[10px] text-rose-100">‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏•‡πá‡∏ö</p>
                    </div>
                </div>
                <button onclick="toggleAIChat()" class="text-white/80 hover:text-white w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/10"><i class="fas fa-chevron-down"></i></button>
            </div>
            
            <div id="ai-chat-container" class="flex-1 overflow-y-auto p-3 space-y-3 bg-gray-50">
                <div class="flex gap-2">
                    <div class="w-7 h-7 bg-rose-500 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-robot text-white text-[10px]"></i>
                    </div>
                    <div class="bg-white p-3 rounded-2xl rounded-tl-none shadow-sm max-w-[85%]">
                        <p class="text-sm text-gray-700">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞ ‡∏ô‡πâ‡∏≠‡∏á‡∏¢‡∏∏‡πâ‡∏¢‡πÄ‡∏≠‡∏á‡∏ô‡∏∞‡∏Ñ‡∏∞ üíÖ<br><br>‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏≥‡πÄ‡∏•‡πá‡∏ö‡πÑ‡∏´‡∏°‡∏Ñ‡∏∞?
                        <br>‚Ä¢ ‡πÄ‡∏•‡πá‡∏ö‡πÅ‡∏´‡πâ‡∏á/‡πÄ‡∏õ‡∏£‡∏≤‡∏∞ ‡πÅ‡∏Å‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏á?
                        <br>‚Ä¢ ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏•‡∏≤‡∏¢/‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå
                        <br>‚Ä¢ ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö‡∏î‡∏π‡πÅ‡∏•‡πÄ‡∏•‡πá‡∏ö
                        <br><br>‡∏ñ‡∏≤‡∏°‡∏°‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞!</p>
                    </div>
                </div>
            </div>
            
            <div class="p-3 border-t bg-white rounded-b-2xl">
                <div class="flex gap-1.5 mb-2 overflow-x-auto no-scrollbar">
                    <button onclick="setAIContext('dry')" class="text-[11px] bg-orange-100 text-orange-600 px-2.5 py-1 rounded-full hover:bg-orange-200 whitespace-nowrap flex-shrink-0">‡πÄ‡∏•‡πá‡∏ö‡πÅ‡∏´‡πâ‡∏á/‡πÄ‡∏õ‡∏£‡∏≤‡∏∞</button>
                    <button onclick="setAIContext('design')" class="text-[11px] bg-pink-100 text-pink-600 px-2.5 py-1 rounded-full hover:bg-pink-200 whitespace-nowrap flex-shrink-0">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏•‡∏≤‡∏¢</button>
                    <button onclick="setAIContext('care')" class="text-[11px] bg-green-100 text-green-600 px-2.5 py-1 rounded-full hover:bg-green-200 whitespace-nowrap flex-shrink-0">‡∏ß‡∏¥‡∏ò‡∏µ‡∏î‡∏π‡πÅ‡∏•‡πÄ‡∏•‡πá‡∏ö</button>
                </div>
                <div class="flex gap-2">
                    <input type="text" id="ai-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°..." class="flex-1 border border-gray-200 rounded-xl px-3 py-2 text-sm focus:outline-none focus:border-rose-500" onkeypress="if(event.key==='Enter')sendAIMessage()">
                    <button onclick="sendAIMessage()" class="bg-rose-500 text-white w-9 h-9 rounded-xl hover:bg-rose-600 flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-paper-plane text-xs"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reviews Modal -->
    <div id="reviews-modal" class="fixed inset-0 bg-black/50 hidden z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-md rounded-2xl p-5 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h3 class="font-bold text-lg text-gray-800 flex items-center gap-2">
                    <i class="fas fa-star text-yellow-500"></i> ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
                </h3>
                <button onclick="closeModal('reviews-modal')" class="text-gray-400"><i class="fas fa-times"></i></button>
            </div>
            
            <div class="bg-gradient-to-r from-yellow-50 to-orange-50 p-4 rounded-xl mb-4">
                <div class="text-center">
                    <div class="text-4xl font-bold text-yellow-500" id="avg-rating">0.0</div>
                    <div class="flex justify-center gap-1 my-2" id="avg-stars"></div>
                    <p class="text-sm text-gray-600">‡∏à‡∏≤‡∏Å <span id="total-reviews">0</span> ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</p>
                </div>
            </div>
            
            <div id="reviews-list" class="space-y-3">
                <p class="text-gray-400 text-center py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏µ‡∏ß‡∏¥‡∏ß...</p>
            </div>
            
            <div class="mt-4 pt-4 border-t">
                <button onclick="showSubmitReview()" class="w-full bg-rose-500 text-white py-2 rounded-xl hover:bg-rose-600">
                    <i class="fas fa-pen mr-2"></i>‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏£‡∏µ‡∏ß‡∏¥‡∏ß
                </button>
            </div>
        </div>
    </div>

    <!-- Submit Review Modal -->
    <div id="submit-review-modal" class="fixed inset-0 bg-black/50 hidden z-[60] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-2xl p-5">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h3 class="font-bold text-lg text-gray-800">‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</h3>
                <button onclick="closeModal('submit-review-modal')" class="text-gray-400"><i class="fas fa-times"></i></button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="text-sm text-gray-600 block mb-2">‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á (Order ID)</label>
                    <input type="text" id="review-order-id" placeholder="‡πÄ‡∏ä‡πà‡∏ô GY-0123456789" class="w-full border border-gray-200 rounded-lg px-3 py-2 text-sm">
                </div>
                <div>
                    <label class="text-sm text-gray-600 block mb-2">‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</label>
                    <div class="flex justify-center gap-2" id="star-rating">
                        <button onclick="setRating(1)" class="text-3xl text-gray-300 hover:text-yellow-400 transition star-btn" data-rating="1"><i class="fas fa-star"></i></button>
                        <button onclick="setRating(2)" class="text-3xl text-gray-300 hover:text-yellow-400 transition star-btn" data-rating="2"><i class="fas fa-star"></i></button>
                        <button onclick="setRating(3)" class="text-3xl text-gray-300 hover:text-yellow-400 transition star-btn" data-rating="3"><i class="fas fa-star"></i></button>
                        <button onclick="setRating(4)" class="text-3xl text-gray-300 hover:text-yellow-400 transition star-btn" data-rating="4"><i class="fas fa-star"></i></button>
                        <button onclick="setRating(5)" class="text-3xl text-gray-300 hover:text-yellow-400 transition star-btn" data-rating="5"><i class="fas fa-star"></i></button>
                    </div>
                    <input type="hidden" id="review-rating" value="0">
                </div>
                <div>
                    <label class="text-sm text-gray-600 block mb-2">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</label>
                    <textarea id="review-text" rows="3" placeholder="‡∏ö‡∏≠‡∏Å‡πÄ‡∏•‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£..." class="w-full border border-gray-200 rounded-lg px-3 py-2 text-sm resize-none"></textarea>
                </div>
                <div>
                    <label class="text-sm text-gray-600 block mb-2">‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏ú‡∏•‡∏á‡∏≤‡∏ô (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
                    <input type="file" id="review-image" accept="image/*" class="w-full text-xs border rounded-lg p-1.5">
                </div>
                <button onclick="submitReview()" class="w-full bg-yellow-500 text-white py-2 rounded-xl hover:bg-yellow-600 font-medium">
                    ‡∏™‡πà‡∏á‡∏£‡∏µ‡∏ß‡∏¥‡∏ß
                </button>
            </div>
        </div>
    </div>

    <div id="slip-modal" class="fixed inset-0 bg-black/80 hidden z-[70] flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-2xl p-4">
            <div class="flex justify-between items-center mb-3">
                <h3 class="font-bold text-gray-800">‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô</h3>
                <button onclick="closeModal('slip-modal')" class="text-gray-400"><i class="fas fa-times"></i></button>
            </div>
            <img id="slip-image" class="w-full rounded-lg mb-4" src="" alt="Payment Slip">
            <div class="flex gap-2">
                <button onclick="approveWithSlip()" class="flex-1 bg-green-500 text-white py-2 rounded-xl font-medium">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                <button onclick="rejectWithSlip()" class="flex-1 bg-red-500 text-white py-2 rounded-xl font-medium">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button>
            </div>
        </div>
    </div>

<script>
// ============================================
// GY-Nail Frontend - Inline JavaScript
// ============================================

// ‚ö†Ô∏è ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô URL ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô Web App URL ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ Deploy Google Apps Script
const API_URL = "https://script.google.com/macros/s/AKfycby1jb7iIn2ROtiT-pnsEpwXRLyeA7EfqJUygJmA7nu6rUnHJmqbc639iMbsp6oUvRGh/exec";

let settings = {}; 
let bookings = [];
let menuData = { services: [], designs: [], addons: [], shapes: [] }; 
let currentManagerTab = 'services';
let shopStatus = { isOpen: true, specialDates: [] };
let queueRefreshInterval = null;
let lastQueueData = null;
let currentSlipRow = null;

const defaultMenu = {
    services: [
        {id:'s1', name:'‡∏ó‡∏≤‡∏™‡∏µ‡πÄ‡∏à‡∏• (‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô)', price:150, icon:'fas fa-paint-brush'},
        {id:'s2', name:'‡∏ó‡∏≤‡∏™‡∏µ‡πÄ‡∏à‡∏• (‡∏•‡∏π‡∏Å‡πÅ‡∏Å‡πâ‡∏ß)', price:200, icon:'fas fa-magic'},
        {id:'s3', name:'‡∏ï‡πà‡∏≠ PVC (‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô)', price:250, icon:'fas fa-hand-holding-heart'}
    ],
    designs: [
        {id:'d1', name:'Minimal', icon:'fas fa-seedling'},
        {id:'d2', name:'Luxury', icon:'fas fa-crown'},
        {id:'d3', name:'Y2K', icon:'fas fa-star'}
    ],
    addons: [
        {id:'a1', name:'‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡πá‡∏ö (Overlay)', price:80},
        {id:'a2', name:'‡∏ñ‡∏≠‡∏î‡πÄ‡∏•‡πá‡∏ö‡πÄ‡∏î‡∏¥‡∏°', price:100}
    ],
    shapes: [
        {id:'sh1', name:'Almond', icon:'üå∞'},
        {id:'sh2', name:'Oval', icon:'ü•ö'},
        {id:'sh3', name:'Square', icon:'üü©'}
    ]
};

// API Functions
const apiCall = (action, params, onSuccess, onFailure) => {
    const queryParams = new URLSearchParams({ action: action });
    const isLargePayload = params.base64 || params.imageData;
    
    let fetchPromise;
    if (isLargePayload) {
        fetchPromise = fetch(`${API_URL}?action=${encodeURIComponent(action)}`, {
            method: "POST",
            body: JSON.stringify(params),
            redirect: "follow",
            mode: "no-cors"
        }).then(() => {
            return { status: 'success', message: 'uploaded' };
        });
    } else {
        for (const key in params) {
            if (params[key] !== undefined && params[key] !== null && params[key] !== '') {
                const value = typeof params[key] === 'object' ? JSON.stringify(params[key]) : params[key];
                queryParams.append(key, value);
            }
        }
        fetchPromise = fetch(`${API_URL}?${queryParams.toString()}`, {
            method: "GET",
            redirect: "follow"
        }).then(r => r.json());
    }

    fetchPromise
    .then(data => {
        if(data.status === 'error' && !data.bookings) {
            if(onFailure) onFailure(data.message);
            else Swal.fire('Error', data.message || 'System Error', 'error');
        } else {
            if(onSuccess) onSuccess(data);
        }
    })
    .catch(e => {
        console.error(`Fetch failed for ${action}`, e);
        if(action === 'getPublicSettings') {
            document.getElementById('loader-icon').classList.add('hidden');
            document.getElementById('loader-error').classList.remove('hidden');
        } else {
            Swal.fire({ icon: 'error', title: '‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á', text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ', confirmButtonColor: '#f43f5e' });
            if (onFailure) onFailure("Connection failed");
        }
    });
};

const googleScriptRun = {
    getPublicSettings: (s, f) => apiCall('getPublicSettings', {}, s, f),
    getBookedSlots: (d, s) => apiCall('getBookedSlots', {date: d}, s),
    submitBooking: (d, s, f) => apiCall('submitBooking', d, s, f),
    searchBooking: (k, s) => apiCall('searchBooking', {key: k}, s),
    adminLogin: (p, s) => apiCall('adminLogin', {pass: p}, s),
    getAdminData: (s) => apiCall('getAdminData', {}, s),
    updateBookingStatus: (r, st, s) => apiCall('updateBookingStatus', {rowIndex: r, status: st}, s),
    deleteBooking: (r, s) => apiCall('deleteBooking', {rowIndex: r}, s),
    saveSettings: (st, s) => apiCall('saveSettings', {settings: st}, s)
};

// Init
window.onload = function() {
    if (API_URL === "YOUR_WEB_APP_URL_HERE") {
        document.getElementById('loader-icon').classList.add('hidden');
        document.getElementById('loader-error').classList.remove('hidden');
        return;
    }
    
    googleScriptRun.getPublicSettings(data => {
        initSuccess(data);
    });
    
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('dateInput').min = today;
    loadShopStatus();
};

function initSuccess(data) {
    settings = data;
    if(settings.shopName) document.getElementById('shopNameHeader').innerText = settings.shopName;
    
    // Dynamic Marquee
    const banner = document.getElementById('marquee-banner');
    if (settings.marqueeText && settings.marqueeText.trim() !== "") {
        document.getElementById('marquee-text').innerText = settings.marqueeText;
        banner.classList.remove('hidden');
    } else {
        banner.classList.add('hidden');
    }
    
    loadContactChannels();
    initSnowfall();
    
    if (settings.menu_config && settings.menu_config !== "") {
        try { menuData = JSON.parse(settings.menu_config); } 
        catch(e) { menuData = defaultMenu; }
    } else {
        menuData = defaultMenu;
    }
    
    ['services', 'designs', 'addons', 'shapes'].forEach(k => {
        if(!menuData[k]) menuData[k] = [];
    });

    renderAllSections();
    document.getElementById('loading').classList.add('hidden');
}

function renderAllSections() {
    renderServices();
    renderDesigns();
    renderAddons();
    renderShapes();
    calculateTotal();
}

function renderServices() {
    const container = document.getElementById('service-list-container');
    container.innerHTML = '';
    if(menuData.services.length === 0) container.innerHTML = '<div class="col-span-2 text-center text-gray-300">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</div>';
    
    menuData.services.forEach((s, index) => {
        const isChecked = index === 0 ? 'checked' : '';
        let iconDisplay = s.icon && (s.icon.startsWith('http') || s.icon.startsWith('data:')) 
            ? `<img src="${s.icon}" class="w-16 h-16 object-cover rounded-lg mb-2 shadow-sm">` 
            : `<i class="${s.icon || 'fas fa-star'} text-2xl mb-2 text-rose-300"></i>`;

        container.innerHTML += `
            <label class="cursor-pointer group">
                <input type="radio" name="service" value="${s.name}" data-price="${s.price}" class="service-radio hidden" ${isChecked} onchange="calculateTotal()">
                <div class="border border-gray-200 rounded-xl p-4 flex flex-col items-center justify-center h-full min-h-[9rem] transition-all hover:border-rose-300 bg-white text-center">
                    ${iconDisplay}
                    <span class="text-sm font-medium leading-tight mb-1">${s.name}</span>
                    <span class="price-tag">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ${s.price}.-</span>
                </div>
            </label>
        `;
    });
}

function renderDesigns() {
    const container = document.getElementById('design-list-container');
    container.innerHTML = '';
    menuData.designs.forEach((d) => {
        let iconDisplay = d.icon && (d.icon.startsWith('http') || d.icon.startsWith('data:')) 
            ? `<img src="${d.icon}" class="w-8 h-8 object-cover rounded-full mb-1">` 
            : `<div class="bg-rose-50 rounded-full w-8 h-8 flex items-center justify-center mb-1 text-rose-400"><i class="${d.icon || 'fas fa-star'}"></i></div>`;

        container.innerHTML += `
            <div class="relative">
                <input type="radio" name="design_select" id="d_${d.id}" class="design-radio hidden" onclick="fillDesign('${d.name}')">
                <label for="d_${d.id}" class="block border border-gray-200 bg-white rounded-lg p-3 text-center cursor-pointer transition-all h-full flex flex-col justify-center items-center">
                    ${iconDisplay}
                    <span class="text-xs font-medium">${d.name}</span>
                    <div class="check-icon hidden absolute top-1 right-1 text-rose-500 text-xs"><i class="fas fa-check-circle"></i></div>
                </label>
            </div>
        `;
    });
}

function renderAddons() {
    const container = document.getElementById('addon-list-container');
    container.innerHTML = '';
    menuData.addons.forEach((a) => {
        container.innerHTML += `
            <label class="block cursor-pointer">
                <input type="checkbox" class="addon-checkbox hidden" value="${a.name}" data-price="${a.price}" onchange="calculateTotal()">
                <div class="border border-gray-200 bg-white rounded-xl p-3 flex justify-between items-center hover:border-rose-300 transition-all">
                    <div class="flex items-center gap-3">
                        <div class="w-5 h-5 rounded border border-gray-300 flex items-center justify-center text-white bg-white"><i class="fas fa-check text-xs hidden check-icon"></i></div>
                        <span class="text-sm text-gray-700">${a.name}</span>
                    </div>
                    <span class="text-xs font-bold text-rose-500">+${a.price}.-</span>
                </div>
            </label>
        `;
    });
}

function renderShapes() {
    const container = document.getElementById('shape-list-container');
    container.innerHTML = '';
    menuData.shapes.forEach((sh, idx) => {
        const isChecked = idx === 0 ? 'checked' : '';
        let iconDisplay = sh.icon && (sh.icon.startsWith('http') || sh.icon.startsWith('data:')) 
            ? `<img src="${sh.icon}" class="w-8 h-8 object-cover mb-1">` 
            : `<div class="text-2xl mb-1">${sh.icon || 'üíÖ'}</div>`;

        container.innerHTML += `
            <div class="flex-shrink-0">
                <input type="radio" name="shape" id="sh_${sh.id}" value="${sh.name}" class="hidden shape-radio" ${isChecked}>
                <label for="sh_${sh.id}" class="border bg-white rounded-lg px-3 py-3 text-center block cursor-pointer transition border-gray-200 min-w-[75px]">
                    ${iconDisplay}
                    <div class="text-[11px] font-medium text-gray-600">${sh.name}</div>
                </label>
            </div>
        `;
    });
}

function fillDesign(txt) {
    const input = document.getElementById('artInput');
    input.value = input.value.includes(txt) ? input.value : (input.value ? txt + ", " + input.value : txt);
    input.classList.add('bg-rose-50', 'border-rose-300');
    setTimeout(() => input.classList.remove('bg-rose-50', 'border-rose-300'), 500);
}

function toggleAddress(show) {
    const field = document.getElementById('addressField');
    if(show) { field.classList.remove('hidden'); field.querySelector('textarea').required = true; }
    else { field.classList.add('hidden'); field.querySelector('textarea').required = false; }
}

function calculateTotal() {
    let total = 0;
    const s = document.querySelector('input[name="service"]:checked'); 
    if(s) total += parseInt(s.dataset.price||0);
    document.querySelectorAll('.addon-checkbox:checked').forEach(cb => {
        total += parseInt(cb.dataset.price||0);
    });
    const d = document.getElementById('totalPriceDisplay');
    d.textContent = total.toLocaleString();
    d.classList.remove('price-pop'); void d.offsetWidth; d.classList.add('price-pop');
}

// Calendar & Slots
document.getElementById('dateInput').addEventListener('change', function() { 
    if(this.value) {
        fetchAvailableSlots(this.value);
        startQueueRefresh(this.value);
    }
});

function fetchAvailableSlots(dateStr) {
    document.getElementById('slotsContainer').classList.add('hidden'); 
    document.getElementById('loadingSlots').classList.remove('hidden'); 
    document.getElementById('selectedTimeInput').value = '';
    googleScriptRun.getBookedSlots(dateStr, res => {
        document.getElementById('loadingSlots').classList.add('hidden'); 
        document.getElementById('slotsContainer').classList.remove('hidden');

        if (res.shopStatus === 'closed') {
            const container = document.getElementById('slotsContainer');
            container.innerHTML = `
                <div class="col-span-3 text-center py-6 bg-red-50 rounded-xl border border-red-200">
                    <i class="fas fa-store-slash text-3xl text-red-400 mb-2"></i>
                    <p class="text-red-600 font-bold">${res.shopMessage || '‡∏£‡πâ‡∏≤‡∏ô‡∏õ‡∏¥‡∏î‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ'}</p>
                    <p class="text-red-400 text-sm mt-1">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏≠‡∏∑‡πà‡∏ô</p>
                </div>`;
            return;
        }

        renderSlots(res.booked || [], res.serverDate, res.serverTime, dateStr);
    });
}

function renderSlots(booked, serverDate, serverTime, selectedDate) {
    const container = document.getElementById('slotsContainer');
    container.innerHTML = '';
    const slots = (settings.timeSlots || "10:00,11:30,13:00,14:30,16:00,17:30").split(',').map(s=>s.trim());
    
    const isToday = (selectedDate === serverDate);

    const bookedMap = {};
    booked.forEach(b => {
        bookedMap[b.time] = { status: b.status, orderId: b.orderId };
    });

    let availableCount = 0;

    slots.forEach(t => {
        const time = t.trim();
        const btn = document.createElement('button'); 
        btn.type = 'button'; 

        if (isToday && time <= serverTime) {
            btn.disabled = true;
            btn.className = 'py-3 rounded-xl text-sm bg-gray-100 text-gray-300 cursor-not-allowed border border-gray-200 line-through';
            btn.innerHTML = `${time} <span class="text-[10px] block">‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</span>`;
        } else if(bookedMap[time]) {
            const bookingInfo = bookedMap[time];
            btn.disabled = true;
            
            if (bookingInfo.status === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß' || bookingInfo.status === '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£' || bookingInfo.status === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô') {
                btn.className = 'py-3 rounded-xl text-sm bg-red-100 text-red-400 cursor-not-allowed border border-red-200';
                btn.innerHTML = `${time} <i class="fas fa-lock text-xs ml-1"></i>`;
            } else if (bookingInfo.status === '‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß' || bookingInfo.status === '‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô') {
                btn.className = 'py-3 rounded-xl text-sm bg-orange-100 text-orange-500 cursor-not-allowed border border-orange-200';
                btn.innerHTML = `${time} <i class="fas fa-clock text-xs ml-1"></i>`;
            } else {
                btn.className = 'py-3 rounded-xl text-sm bg-gray-100 text-gray-400 cursor-not-allowed';
                btn.textContent = time;
            }
        } else {
            availableCount++;
            btn.className = 'time-btn py-3 rounded-xl text-sm bg-white text-gray-600 border border-rose-100 hover:border-rose-400 hover:text-rose-500 transition shadow-sm font-medium';
            btn.textContent = time;
            btn.onclick = () => { 
                document.querySelectorAll('.time-btn').forEach(b=>b.classList.remove('active')); 
                btn.classList.add('active'); 
                document.getElementById('selectedTimeInput').value = time; 
            };
        }
        container.appendChild(btn);
    });

    if (availableCount === 0) {
        const msg = document.createElement('div');
        msg.className = 'col-span-3 text-center py-4 bg-yellow-50 rounded-xl border border-yellow-200 mt-2';
        msg.innerHTML = '<i class="fas fa-exclamation-circle text-yellow-500 mr-1"></i> <span class="text-yellow-700 text-sm font-medium">‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏∏‡∏Å‡∏£‡∏≠‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏≠‡∏∑‡πà‡∏ô</span>';
        container.appendChild(msg);
    }
    
    const legend = document.createElement('div');
    legend.className = 'col-span-3 mt-3 p-3 bg-gray-50 rounded-xl text-xs space-y-1';
    legend.innerHTML = `
        <div class="flex items-center gap-2"><div class="w-3 h-3 bg-red-100 border border-red-200 rounded"></div><span class="text-gray-600">‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß - ‡∏à‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</span></div>
        <div class="flex items-center gap-2"><div class="w-3 h-3 bg-orange-100 border border-orange-200 rounded"></div><span class="text-gray-600">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö - ‡∏à‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</span></div>
        ${isToday ? '<div class="flex items-center gap-2"><div class="w-3 h-3 bg-gray-100 border border-gray-200 rounded"></div><span class="text-gray-600">‡πÄ‡∏ß‡∏•‡∏≤‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß</span></div>' : ''}
        <div class="flex items-center gap-2"><div class="w-3 h-3 bg-white border border-rose-100 rounded"></div><span class="text-gray-600">‡∏ß‡πà‡∏≤‡∏á - ‡∏à‡∏≠‡∏á‡πÑ‡∏î‡πâ</span></div>
    `;
    container.appendChild(legend);
}

// Submit Booking
function handleBooking(e) {
    e.preventDefault();
    const timeInput = document.getElementById('selectedTimeInput');
    if(!timeInput.value) return Swal.fire({icon:'warning', title:'‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤', confirmButtonColor:'#f43f5e'});
    
    if (!shopStatus.isOpen) {
        const selectedDate = document.getElementById('dateInput').value;
        const todaySpecial = shopStatus.specialDates.find(d => d.date === selectedDate && d.status === 'open');
        if (!todaySpecial) {
            return Swal.fire({ icon: 'error', title: '‡∏£‡πâ‡∏≤‡∏ô‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏à‡∏≠‡∏á', html: '‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡∏£‡πâ‡∏≤‡∏ô‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏à‡∏≠‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß', confirmButtonColor: '#f43f5e' });
        }
    }
    
    const selectedDate = document.getElementById('dateInput').value;
    const todaySpecial = shopStatus.specialDates.find(d => d.date === selectedDate);
    if (todaySpecial && todaySpecial.status === 'closed') {
        return Swal.fire({ icon: 'error', title: '‡∏£‡πâ‡∏≤‡∏ô‡∏õ‡∏¥‡∏î‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ', html: `‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡∏£‡πâ‡∏≤‡∏ô‡∏õ‡∏¥‡∏î‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å<br><b>${todaySpecial.note}</b>`, confirmButtonColor: '#f43f5e' });
    }
    
    const btn = document.getElementById('submitBtn'); 
    const oldTxt = btn.innerHTML;
    btn.disabled = true; 
    btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏≠‡∏á...';
    
    const f = document.getElementById('bookingForm');
    const addons = [];
    document.querySelectorAll('.addon-checkbox:checked').forEach(cb => addons.push(cb.value));
    
    const data = {
        service: f.service.value, 
        extension: addons.join(', ') || '-', 
        removal: '-', 
        design: f.design.value, 
        shape: f.shape.value, 
        date: f.date.value, 
        time: f.time.value,
        name: f.name.value, 
        phone: f.phone.value, 
        locationType: f.locationType.value,
        address: f.address ? f.address.value : '', 
        price: document.getElementById('totalPriceDisplay').textContent,
        details: f.design.value 
    };

    googleScriptRun.submitBooking(data, res => {
        btn.disabled = false; 
        btn.innerHTML = oldTxt;
        if(res.status === 'success') {
            const calLink = buildCalendarLink(data.service, data.date, data.time, res.orderId, data.phone, data.price);
            Swal.fire({
                icon:'success', 
                title:'‡∏à‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 
                html:`‡∏£‡∏´‡∏±‡∏™: <b>${res.orderId}</b><br><br>
                    <a href="${calLink}" target="_blank" class="inline-flex items-center gap-2 bg-blue-500 text-white px-4 py-2 rounded-xl text-sm font-medium hover:bg-blue-600 transition shadow-md">
                        <i class="fas fa-calendar-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô Google
                    </a><br><br>
                    <span class="text-gray-400 text-xs">‡πÅ‡∏Ñ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÑ‡∏ß‡πâ‡∏ô‡∏∞‡∏Ñ‡∏∞</span>`, 
                confirmButtonColor:'#f43f5e'
            })
            .then(() => { 
                f.reset(); 
                document.getElementById('totalPriceDisplay').textContent = "0"; 
                switchTab('search');
                document.getElementById('search-key').value = res.orderId;
                doSearch();
            });
        } else {
            Swal.fire({ icon: 'error', title: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏≠‡∏á‡πÑ‡∏î‡πâ', html: res.message, confirmButtonColor: '#f43f5e' })
            .then(() => {
                if (document.getElementById('dateInput').value) {
                    fetchAvailableSlots(document.getElementById('dateInput').value);
                }
            });
        }
    }, err => { 
        btn.disabled = false; 
        btn.innerHTML = oldTxt; 
        Swal.fire('Error', 'Connection Failed', 'error'); 
    });
}

// Search
function doSearch() {
    const key = document.getElementById('search-key').value;
    if(!key) return;
    const resDiv = document.getElementById('search-result');
    const errDiv = document.getElementById('search-error');
    resDiv.innerHTML = '<div class="text-center text-rose-400"><i class="fas fa-circle-notch fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...</div>';
    resDiv.classList.remove('hidden'); 
    errDiv.classList.add('hidden');

    googleScriptRun.searchBooking(key, res => {
        if(res.status === 'found') {
            const d = res.data;
            let stColor = 'bg-yellow-100 text-yellow-600';
            if(d.status === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß') stColor = 'bg-green-100 text-green-600';
            if(d.status === '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å') stColor = 'bg-red-100 text-red-600';
            let dateDisplay = d.date;
            try { dateDisplay = new Date(d.date).toLocaleDateString('th-TH'); } catch(e){}

            resDiv.innerHTML = `
                <div class="bg-white border border-rose-100 rounded-xl p-4 shadow-sm relative overflow-hidden">
                    <div class="absolute top-0 right-0 px-3 py-1 text-xs font-bold rounded-bl-xl ${stColor}">${d.status}</div>
                    <div class="text-xs text-gray-400 mb-1">#${d.orderId}</div>
                    <h3 class="font-bold text-rose-600 text-lg mb-2">${d.service}</h3>
                    <div class="text-sm text-gray-600 space-y-1">
                        <div><i class="far fa-calendar w-5 text-rose-400"></i> ${dateDisplay}</div>
                        <div><i class="far fa-clock w-5 text-rose-400"></i> ${d.time}</div>
                        <div><i class="fas fa-map-marker-alt w-5 text-rose-400"></i> ${d.location}</div>
                        <div><i class="fas fa-tag w-5 text-rose-400"></i> ${d.price} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    ${d.status !== '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' ? `
                    <div class="mt-3 pt-3 border-t border-gray-100">
                        <a href="${buildCalendarLink(d.service, d.date, d.time, d.orderId, '', d.price)}" target="_blank" 
                           class="flex items-center justify-center gap-2 bg-blue-50 text-blue-600 py-2 rounded-xl text-sm font-medium hover:bg-blue-100 transition border border-blue-200">
                            <i class="fas fa-calendar-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô Google
                        </a>
                    </div>` : ''}
                </div>`;
        } else { resDiv.innerHTML = ''; errDiv.classList.remove('hidden'); }
    });
}

// Admin Functions
function switchTab(tab) {
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(`tab-${tab}`).classList.add('active');
    ['booking', 'search', 'admin'].forEach(p => {
        const el = document.getElementById(`page-${p}`);
        if(p === tab) el.classList.remove('hidden');
        else el.classList.add('hidden');
    });
}

function doLogin() {
    const p = document.getElementById('admin-pass').value;
    googleScriptRun.adminLogin(p, res => {
        if(res.status === 'success') {
            document.getElementById('admin-login').classList.add('hidden');
            document.getElementById('admin-dash').classList.remove('hidden');
            loadAdminData();
            loadDashboardStats();
        } else Swal.fire('Error', '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
    });
}

function adminLogout() {
    document.getElementById('admin-dash').classList.add('hidden');
    document.getElementById('admin-login').classList.remove('hidden');
    document.getElementById('admin-pass').value = '';
}

function loadAdminData() {
    const list = document.getElementById('booking-list');
    list.innerHTML = '<div class="text-center mt-10 text-gray-400"><i class="fas fa-circle-notch fa-spin"></i> ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>';
    googleScriptRun.getAdminData(res => {
        settings = res.settings; 
        bookings = res.bookings;
        if(settings.menu_config && settings.menu_config !== "") { 
            try { menuData = JSON.parse(settings.menu_config); } catch(e){} 
        }
        list.innerHTML = '';
        if(bookings.length === 0) { list.innerHTML = '<div class="text-center mt-10 text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</div>'; return; }
        bookings.forEach(b => {
            let stColor = 'text-yellow-500';
            if(b.status === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß') stColor = 'text-green-500';
            if(b.status === '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å') stColor = 'text-red-500';
            let dateDisplay = b.date;
            try { dateDisplay = new Date(b.date).toLocaleDateString('th-TH'); } catch(e){}
            const item = document.createElement('div');
            item.className = 'bg-white p-4 rounded-xl shadow-sm border border-gray-100 relative';
            let formattedDate = b.date;
            let formattedTime = b.time;
            try {
                const d = new Date(b.date);
                if (!isNaN(d)) {
                    formattedDate = d.toLocaleDateString('th-TH', { weekday: 'short', day: 'numeric', month: 'short', year: 'numeric' });
                }
                if (b.time && b.time.includes('T')) {
                    const t = new Date(b.time);
                    if (!isNaN(t)) {
                        formattedTime = t.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' });
                    }
                }
            } catch(e) {}
            let phoneDisplay = String(b.phone || '');
            if (phoneDisplay.length === 9 && !phoneDisplay.startsWith('0')) phoneDisplay = '0' + phoneDisplay;
            
            item.innerHTML = `
                <div class="flex justify-between items-start mb-2">
                    <div><span class="text-xs text-gray-400">#${b.orderId}</span><div class="font-bold text-gray-800">${b.name} <span class="text-xs font-normal text-gray-500">(${phoneDisplay})</span></div></div>
                    <span class="text-xs font-bold ${stColor}">${b.status}</span>
                </div>
                <div class="bg-rose-50 rounded-lg p-2 mb-3 border border-rose-100">
                    <div class="flex items-center justify-center gap-3">
                        <div class="text-center">
                            <div class="text-xs text-rose-400">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</div>
                            <div class="font-bold text-rose-600 text-sm">${formattedDate}</div>
                        </div>
                        <div class="w-px h-8 bg-rose-200"></div>
                        <div class="text-center">
                            <div class="text-xs text-rose-400">‡πÄ‡∏ß‡∏•‡∏≤</div>
                            <div class="font-bold text-rose-600 text-sm">${formattedTime}</div>
                        </div>
                    </div>
                </div>
                <div class="text-sm text-gray-600 mb-3">
                    <div class="flex items-center gap-2"><i class="fas fa-spa text-rose-300"></i> ${b.service}</div>
                    ${b.price ? `<div class="flex items-center gap-2"><i class="fas fa-tag text-rose-300"></i> ${b.price} ‡∏ö‡∏≤‡∏ó</div>` : ''}
                </div>
                <div class="flex gap-2 border-t pt-2 mt-2">
                    <button onclick="updateStatus(${b.row}, '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß')" class="flex-1 py-1.5 text-xs bg-green-50 text-green-600 rounded hover:bg-green-100">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
                    <button onclick="updateStatus(${b.row}, '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å')" class="flex-1 py-1.5 text-xs bg-red-50 text-red-600 rounded hover:bg-red-100">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button onclick="deleteBooking(${b.row})" class="px-3 py-1.5 text-xs bg-gray-100 text-gray-400 rounded hover:bg-gray-200"><i class="fas fa-trash"></i></button>
                </div>`;
            list.appendChild(item);
        });
    });
}

function updateStatus(row, status) { 
    if(!confirm(`‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô "${status}" ?`)) return; 
    googleScriptRun.updateBookingStatus(row, status, () => {
        loadAdminData();
        loadDashboardStats();
    }); 
}

function deleteBooking(row) { 
    if(!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?")) return; 
    googleScriptRun.deleteBooking(row, () => {
        loadAdminData();
        loadDashboardStats();
    }); 
}

function showSettingsModal() {
    const container = document.getElementById('settings-form');
    container.innerHTML = '';
    const fields = [
        {k: 'shopName', l: '‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô'},
        {k: 'timeSlots', l: '‡∏£‡∏≠‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ (‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢ ,)'},
        {k: 'notifyEmails', l: 'Email ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ä‡πà‡∏≤‡∏á/‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢ ,)'},
        {k: 'marqueeText', l: '‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡πâ‡∏≤‡∏¢‡∏ß‡∏¥‡πà‡∏á'}
    ];
    
    let contactChannels = {};
    try { contactChannels = JSON.parse(settings.contactChannels || '{}'); } catch(e) {}
    
    const contactFields = [
        {k: 'facebook', l: 'Facebook URL', icon: 'fab fa-facebook', color: 'text-[#1877F2]'},
        {k: 'tiktok', l: 'TikTok URL', icon: 'fab fa-tiktok', color: 'text-gray-800'},
        {k: 'phone', l: '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå', icon: 'fas fa-phone', color: 'text-green-500'}
    ];
    
    fields.forEach(f => {
        container.innerHTML += `<div><label class="text-xs font-bold text-gray-500">${f.l}</label><input type="text" id="set-${f.k}" value="${settings[f.k]||''}" class="w-full border border-gray-200 rounded-lg px-3 py-1.5 text-sm focus:border-rose-500 outline-none"></div>`;
    });
    
    container.innerHTML += `<div class="border-t pt-3 mt-3"><h4 class="font-bold text-gray-700 text-sm mb-2">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</h4></div>`;
    contactFields.forEach(f => {
        container.innerHTML += `<div><label class="text-xs font-medium text-gray-500 flex items-center gap-1"><i class="${f.icon} ${f.color}"></i> ${f.l}</label><input type="text" id="set-contact-${f.k}" value="${contactChannels[f.k]||''}" placeholder="${f.k === 'phone' ? '0812345678' : 'https://...'}" class="w-full border border-gray-200 rounded-lg px-3 py-1.5 text-sm focus:border-rose-500 outline-none"></div>`;
    });
    
    document.getElementById('settings-modal').classList.remove('hidden');
}

function closeModal(id) {
    document.getElementById(id).classList.add('hidden');
}

function saveSettings() {
    const newSet = {};
    document.querySelectorAll('#settings-form input').forEach(inp => { 
        if (!inp.id.startsWith('set-contact-')) {
            newSet[inp.id.replace('set-', '')] = inp.value; 
        }
    });
    newSet['menu_config'] = settings.menu_config;
    
    const contactChannels = {
        facebook: document.getElementById('set-contact-facebook').value || '',
        tiktok: document.getElementById('set-contact-tiktok').value || '',
        phone: document.getElementById('set-contact-phone').value || ''
    };
    newSet.contactChannels = JSON.stringify(contactChannels);
    
    googleScriptRun.saveSettings(newSet, () => {
        closeModal('settings-modal');
        Swal.fire('Saved', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
        loadAdminData();
        loadContactChannels();
    });
}

function openServiceManager(tab) { 
    switchManagerTab(tab); 
    document.getElementById('service-modal').classList.remove('hidden'); 
}

function closeServiceManager() { 
    closeModal('service-modal'); 
    renderAllSections(); 
}

function switchManagerTab(tab) {
    currentManagerTab = tab;
    document.querySelectorAll('.cat-tab').forEach(b => b.classList.remove('active'));
    document.getElementById(`mgr-tab-${tab}`).classList.add('active');
    renderManagerList();
}

function renderManagerList() {
    const list = document.getElementById('admin-service-list');
    list.innerHTML = '';
    const items = menuData[currentManagerTab] || [];
    if(items.length === 0) list.innerHTML = '<div class="text-center text-gray-400 py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>';
    items.forEach((s) => {
        let iconDisplay = s.icon && (s.icon.startsWith('http') || s.icon.startsWith('data:')) ? `<img src="${s.icon}" class="w-8 h-8 object-cover rounded">` : `<i class="${s.icon||'fas fa-star'}"></i>`;
        let priceDisplay = s.price !== undefined ? `<div class="text-xs text-gray-500">${s.price} ‡∏ö‡∏≤‡∏ó</div>` : '';
        list.innerHTML += `<div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg border border-gray-100 mb-2"><div class="flex items-center gap-3 overflow-hidden"><div class="w-8 h-8 flex-shrink-0 bg-white rounded flex items-center justify-center border text-rose-400 text-xs">${iconDisplay}</div><div class="truncate"><div class="font-bold text-sm truncate">${s.name}</div>${priceDisplay}</div></div><div class="flex gap-1"><button onclick="openServiceEdit('${s.id}')" class="w-8 h-8 bg-blue-100 text-blue-600 rounded hover:bg-blue-200"><i class="fas fa-pen text-xs"></i></button><button onclick="deleteService('${s.id}')" class="w-8 h-8 bg-red-100 text-red-600 rounded hover:bg-red-200"><i class="fas fa-trash text-xs"></i></button></div></div>`;
    });
}

function openServiceEdit(id) {
    const modal = document.getElementById('service-edit-modal');
    const title = document.getElementById('svc-form-title');
    document.getElementById('svc-id').value = ''; 
    document.getElementById('svc-name').value = ''; 
    document.getElementById('svc-price').value = ''; 
    document.getElementById('svc-icon').value = '';
    const priceContainer = document.getElementById('field-price-container');
    if(currentManagerTab === 'services' || currentManagerTab === 'addons') priceContainer.classList.remove('hidden'); 
    else priceContainer.classList.add('hidden');
    
    if(id) {
        const s = menuData[currentManagerTab].find(x => x.id === id);
        if(s) { 
            title.innerText = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£'; 
            document.getElementById('svc-id').value = s.id; 
            document.getElementById('svc-name').value = s.name; 
            if(s.price !== undefined) document.getElementById('svc-price').value = s.price; 
            document.getElementById('svc-icon').value = s.icon || ''; 
        }
    } else title.innerText = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà';
    modal.classList.remove('hidden');
}

function saveServiceData() {
    const id = document.getElementById('svc-id').value; 
    const name = document.getElementById('svc-name').value; 
    const price = document.getElementById('svc-price').value; 
    const icon = document.getElementById('svc-icon').value;
    if(!name) return Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£', 'warning');
    const item = { name, icon };
    if(currentManagerTab === 'services' || currentManagerTab === 'addons') item.price = parseInt(price) || 0;
    if(id) { 
        const idx = menuData[currentManagerTab].findIndex(s => s.id === id); 
        if(idx !== -1) { item.id = id; menuData[currentManagerTab][idx] = item; } 
    } else { 
        item.id = 'i_' + Date.now(); 
        menuData[currentManagerTab].push(item); 
    }
    closeModal('service-edit-modal');
    saveMenuToBackend();
}

function deleteService(id) { 
    if(!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?')) return; 
    menuData[currentManagerTab] = menuData[currentManagerTab].filter(s => s.id !== id); 
    saveMenuToBackend(); 
}

function saveMenuToBackend() {
    renderManagerList();
    const newSet = { ...settings };
    newSet['menu_config'] = JSON.stringify(menuData);
    googleScriptRun.saveSettings(newSet, () => {
        settings.menu_config = newSet.menu_config;
        renderAllSections();
    });
}

// Real-time Queue
function startQueueRefresh(date) {
    stopQueueRefresh();
    updateQueueStatus(date);
    const today = new Date().toISOString().split('T')[0];
    const isToday = (date === today);
    const refreshInterval = isToday ? 10000 : 60000;
    queueRefreshInterval = setInterval(() => updateQueueStatus(date), refreshInterval);
}

function stopQueueRefresh() {
    if (queueRefreshInterval) {
        clearInterval(queueRefreshInterval);
        queueRefreshInterval = null;
    }
}

function updateQueueStatus(date) {
    if (!date) return;
    apiCall('getBookingsByDate', { date: date }, (res) => {
        if (res.status === 'success') displayQueueStatus(res.data, date);
    });
}

function displayQueueStatus(bookings, date) {
    const queueStatusDiv = document.getElementById('queueStatus');
    const queueInfoDiv = document.getElementById('queueInfo');
    
    if (!bookings || bookings.length === 0) {
        queueStatusDiv.classList.add('hidden');
        return;
    }
    
    queueStatusDiv.classList.remove('hidden');
    
    const timeGroups = {
        'morning': { label: '‡πÄ‡∏ä‡πâ‡∏≤ (10:00-12:00)', booked: 0 },
        'afternoon': { label: '‡∏ö‡πà‡∏≤‡∏¢ (13:00-15:00)', booked: 0 },
        'evening': { label: '‡πÄ‡∏¢‡πá‡∏ô (16:00-18:00)', booked: 0 }
    };
    
    bookings.forEach(b => {
        const hour = parseInt(b.time.split(':')[0]);
        if (hour >= 10 && hour < 13) timeGroups.morning.booked++;
        else if (hour >= 13 && hour < 16) timeGroups.afternoon.booked++;
        else if (hour >= 16 && hour < 19) timeGroups.evening.booked++;
    });
    
    const slotsPerPeriod = 3;
    let totalBooked = 0;
    let totalAvailable = 0;
    let html = '';
    
    Object.keys(timeGroups).forEach(key => {
        const group = timeGroups[key];
        const available = Math.max(0, slotsPerPeriod - group.booked);
        totalBooked += group.booked;
        totalAvailable += available;
        
        if (group.booked > 0) {
            const percentBooked = (group.booked / slotsPerPeriod) * 100;
            let statusColor = 'bg-green-400';
            let statusText = '‡∏ß‡πà‡∏≤‡∏á';
            if (percentBooked >= 100) { statusColor = 'bg-red-400'; statusText = '‡πÄ‡∏ï‡πá‡∏°'; }
            else if (percentBooked >= 50) { statusColor = 'bg-yellow-400'; statusText = '‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ô‡πâ‡∏≠‡∏¢'; }
            
            html += `<div class="flex items-center justify-between bg-white rounded-lg p-2 shadow-sm">
                <div class="flex items-center gap-2"><div class="w-2 h-2 rounded-full ${statusColor}"></div><span class="text-sm text-gray-700">${group.label}</span></div>
                <div class="text-right"><span class="text-sm font-bold text-rose-600">${group.booked}/${slotsPerPeriod}</span><span class="text-xs text-gray-400 ml-1">${statusText}</span></div>
            </div>`;
        }
    });
    
    if (html === '') html = '<div class="text-center text-gray-400 text-sm py-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>';
    
    queueInfoDiv.innerHTML = html;
    document.getElementById('bookedCount').textContent = totalBooked + ' ‡∏Ñ‡∏ô';
    document.getElementById('availableCount').textContent = totalAvailable + ' ‡∏Ñ‡∏ô';
    lastQueueData = bookings;
}

// Shop Status (Client Side Only)
function loadShopStatus() {
    apiCall('getShopStatus', {}, (res) => {
        if (res.status === 'success') {
            shopStatus = res.data;
            updateShopStatusUI();
            // Remove the call to updateAdminShopStatusUI as it's now handled by React
        }
    });
}

function updateShopStatusUI() {
    const badge = document.getElementById('shopStatusBadge');
    const openDiv = document.getElementById('shopStatusOpen');
    const closedDiv = document.getElementById('shopStatusClosed');
    
    if (!badge || !openDiv || !closedDiv) return; // Safety check
    
    badge.classList.remove('hidden');
    if (shopStatus.isOpen) { 
        openDiv.classList.remove('hidden'); 
        closedDiv.classList.add('hidden'); 
    } else { 
        openDiv.classList.add('hidden'); 
        closedDiv.classList.remove('hidden'); 
    }
}

// These functions are now handled inside the AdminDashboard React component
function toggleShopStatus() { /* Handled by React */ }
function updateAdminShopStatusUI() { /* Handled by React */ }

function showShopScheduleModal() {
    loadSpecialDates();
    document.getElementById('shop-schedule-modal').classList.remove('hidden');
}

function loadSpecialDates() {
    apiCall('getSpecialDates', {}, (res) => {
        if (res.status === 'success') {
            shopStatus.specialDates = res.data;
            renderSpecialDatesList();
        }
    });
}

function renderSpecialDatesList() {
    const container = document.getElementById('specialDatesList');
    if (shopStatus.specialDates.length === 0) {
        container.innerHTML = '<p class="text-gray-400 text-sm text-center py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ</p>';
        return;
    }
    container.innerHTML = shopStatus.specialDates.map((date, index) => `
        <div class="flex items-center justify-between bg-gray-50 p-3 rounded-lg">
            <div class="flex items-center gap-2">
                <i class="fas ${date.status === 'closed' ? 'fa-door-closed text-red-500' : 'fa-door-open text-green-500'}"></i>
                <div>
                    <div class="text-sm font-medium">${new Date(date.date).toLocaleDateString('th-TH')}</div>
                    <div class="text-xs text-gray-500">${date.note || (date.status === 'closed' ? '‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô' : '‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô')}</div>
                </div>
            </div>
            <button onclick="removeSpecialDate(${index})" class="text-red-400 hover:text-red-600 p-1"><i class="fas fa-trash-alt"></i></button>
        </div>
    `).join('');
}

function addSpecialDate() {
    const dateInput = document.getElementById('specialDateInput');
    const statusInput = document.getElementById('specialDateStatus');
    const noteInput = document.getElementById('specialDateNote');
    
    if (!dateInput.value) { Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà', 'warning'); return; }
    
    const newDate = { date: dateInput.value, status: statusInput.value, note: noteInput.value || (statusInput.value === 'closed' ? '‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô' : '‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©') };
    
    apiCall('addSpecialDate', { date: newDate }, (res) => {
        if (res.status === 'success') {
            dateInput.value = '';
            noteInput.value = '';
            loadSpecialDates();
            Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
        }
    });
}

function removeSpecialDate(index) {
    if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?')) return;
    apiCall('removeSpecialDate', { index: index }, (res) => {
        if (res.status === 'success') loadSpecialDates();
    });
}

// Dashboard Stats
function loadDashboardStats() {
    const errorDiv = document.getElementById('admin-dash-error');
    if (errorDiv) errorDiv.classList.add('hidden');

    apiCall('getDashboardStats', {}, (res) => {
        if (res.status === 'success') {
            const d = res.data;
            document.getElementById('today-revenue').textContent = '‡∏ø' + d.today.revenue.toLocaleString();
            document.getElementById('month-revenue').textContent = '‡∏ø' + d.month.revenue.toLocaleString();
            const totalRevEl = document.getElementById('total-revenue');
            if (totalRevEl) totalRevEl.textContent = '‡∏ø' + (d.total ? d.total.revenue : 0).toLocaleString();
            document.getElementById('pending-count').textContent = d.pending;
            
            const badge = document.getElementById('pending-badge');
            if (d.pending > 0) { badge.textContent = d.pending; badge.classList.remove('hidden'); }
            else badge.classList.add('hidden');

            // Render 7-Day Chart
            const chartDiv = document.getElementById('admin-revenue-chart');
            if (chartDiv && d.chart7Days) {
                let maxRev = Math.max(...d.chart7Days.map(item => item.revenue), 100);
                chartDiv.innerHTML = d.chart7Days.map(item => {
                    const height = (item.revenue / maxRev) * 100;
                    return `<div class="flex-1 flex flex-col items-center group relative h-full justify-end">
                        <div class="w-full bg-rose-400 rounded-t-sm transition-all hover:bg-rose-500" style="height: ${Math.max(5, height)}%">
                            <div class="hidden group-hover:block absolute -top-8 left-1/2 -translate-x-1/2 bg-gray-800 text-white text-[10px] px-2 py-1 rounded whitespace-nowrap z-10">‡∏ø${item.revenue.toLocaleString()}</div>
                        </div>
                        <div class="text-[9px] text-gray-400 mt-1 font-medium">${item.label}</div>
                    </div>`;
                }).join('');
            }

            // Render Top Services
            const serviceDiv = document.getElementById('top-services-list');
            if (serviceDiv && d.topServices) {
                serviceDiv.innerHTML = d.topServices.length ? d.topServices.map((s, idx) => `
                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg border border-gray-100">
                        <div class="flex items-center gap-2">
                            <span class="w-5 h-5 flex items-center justify-center bg-rose-500 text-white text-[10px] rounded-full font-bold">${idx+1}</span>
                            <span class="text-gray-700 truncate w-24 sm:w-auto font-medium">${s.name}</span>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-gray-800">${s.count} ‡∏Ñ‡∏¥‡∏ß</div>
                            <div class="text-[10px] text-gray-400">‡∏ø${s.revenue.toLocaleString()}</div>
                        </div>
                    </div>
                `).join('') : '<p class="text-center text-gray-400 py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</p>';
            }

            // Render Staff Stats
            const staffDiv = document.getElementById('staff-stats-list');
            if (staffDiv && d.byStaff) {
                staffDiv.innerHTML = d.byStaff.length ? d.byStaff.map(s => `
                    <div class="bg-white border border-gray-100 p-3 rounded-xl shadow-sm hover:shadow-md transition">
                        <div class="flex items-center gap-3 mb-2">
                            <div class="w-10 h-10 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center font-bold text-sm shadow-inner">${s.name[0]}</div>
                            <div>
                                <div class="font-bold text-gray-800 text-sm">${s.name}</div>
                                <div class="text-[10px] text-gray-400">‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô‡∏™‡∏∞‡∏™‡∏°</div>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-2 text-center">
                            <div class="bg-blue-50/50 p-2 rounded-lg">
                                <div class="text-[10px] text-gray-400">‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>
                                <div class="font-bold text-blue-600">${s.count} ‡∏Ñ‡∏¥‡∏ß</div>
                            </div>
                            <div class="bg-green-50/50 p-2 rounded-lg">
                                <div class="text-[10px] text-gray-400">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°</div>
                                <div class="font-bold text-green-600">‡∏ø${s.revenue.toLocaleString()}</div>
                            </div>
                        </div>
                    </div>
                `).join('') : '<p class="text-center text-gray-400 py-4 col-span-full">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡πà‡∏≤‡∏á</p>';
            }
        } else {
            if (errorDiv) {
                errorDiv.classList.remove('hidden');
                errorDiv.innerHTML = `<i class="fas fa-exclamation-triangle mr-2"></i> ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ${res.message || 'Unknown error'}`;
            }
        }
    }, (err) => {
        if (errorDiv) {
            errorDiv.classList.remove('hidden');
            errorDiv.innerHTML = `<i class="fas fa-wifi-slash mr-2"></i> ‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï`;
        }
    });
}

function showPendingApprovals() {
    const list = document.getElementById('booking-list');
    list.innerHTML = '<div class="text-center mt-10 text-gray-400"><i class="fas fa-circle-notch fa-spin"></i> ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>';
    
    apiCall('getAdminData', {}, (res) => {
        const pending = res.bookings.filter(b => b.status === '‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß');
        if (pending.length === 0) { list.innerHTML = '<div class="text-center mt-10 text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div>'; return; }
        
        list.innerHTML = '<h4 class="font-bold text-orange-500 mb-3">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (' + pending.length + ')</h4>';
        pending.forEach(b => {
            let formattedDate = b.date;
            let formattedTime = b.time;
            try {
                const d = new Date(b.date);
                if (!isNaN(d)) {
                    formattedDate = d.toLocaleDateString('th-TH', { weekday: 'short', day: 'numeric', month: 'short', year: 'numeric' });
                }
                if (b.time && b.time.includes('T')) {
                    const t = new Date(b.time);
                    if (!isNaN(t)) {
                        formattedTime = t.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' });
                    }
                }
            } catch(e) {}
            const item = document.createElement('div');
            item.className = 'bg-orange-50 p-4 rounded-xl shadow-sm border border-orange-200 relative';
            item.innerHTML = `
                <div class="flex justify-between items-start mb-2">
                    <div><span class="text-xs text-gray-400">#${b.orderId}</span><div class="font-bold text-gray-800">${b.name}</div></div>
                    <span class="text-xs font-bold text-orange-500">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</span>
                </div>
                <div class="bg-white rounded-lg p-2 mb-3 border border-orange-100">
                    <div class="flex items-center justify-center gap-3">
                        <div class="text-center">
                            <div class="text-xs text-orange-400">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</div>
                            <div class="font-bold text-orange-600 text-sm">${formattedDate}</div>
                        </div>
                        <div class="w-px h-8 bg-orange-200"></div>
                        <div class="text-center">
                            <div class="text-xs text-orange-400">‡πÄ‡∏ß‡∏•‡∏≤</div>
                            <div class="font-bold text-orange-600 text-sm">${formattedTime}</div>
                        </div>
                    </div>
                </div>
                <div class="text-sm text-gray-600 mb-3">
                    <div class="flex items-center gap-2"><i class="fas fa-spa text-orange-400"></i> ${b.service}</div>
                    <div class="flex items-center gap-2"><i class="fas fa-tag text-orange-400"></i> ${b.price} ‡∏ö‡∏≤‡∏ó</div>
                </div>
                <div class="flex gap-2">
                    ${b.slipUrl ? `<button onclick="viewPaymentSlip('${b.slipUrl}', ${b.row})" class="flex-1 py-1.5 text-xs bg-blue-100 text-blue-600 rounded">‡∏î‡∏π‡∏™‡∏•‡∏¥‡∏õ</button>` : ''}
                    <button onclick="approveBookingWithSlip(${b.row})" class="flex-1 py-1.5 text-xs bg-green-100 text-green-600 rounded">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                    <button onclick="rejectBooking(${b.row})" class="flex-1 py-1.5 text-xs bg-red-100 text-red-600 rounded">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button>
                </div>
            `;
            list.appendChild(item);
        });
    });
}

function viewPaymentSlip(slipUrl, row) {
    currentSlipRow = row;
    document.getElementById('slip-image').src = slipUrl || '';
    document.getElementById('slip-modal').classList.remove('hidden');
}

function approveBookingWithSlip(row) {
    if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏¥‡∏ß‡∏ô‡∏µ‡πâ?')) return;
    apiCall('updateBookingStatus', { rowIndex: row, status: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß' }, () => {
        Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
        loadAdminData();
        loadDashboardStats();
    });
}

function approveWithSlip() {
    if (currentSlipRow) {
        approveBookingWithSlip(currentSlipRow);
        closeModal('slip-modal');
    }
}

function rejectWithSlip() {
    if (currentSlipRow) {
        const reason = prompt('‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò:');
        if (reason) {
            updateStatus(currentSlipRow, '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å');
            closeModal('slip-modal');
        }
    }
}

function rejectBooking(row) {
    if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Ñ‡∏¥‡∏ß‡∏ô‡∏µ‡πâ?')) return;
    updateStatus(row, '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å');
}

// CRM
function showCustomersPage() {
    const list = document.getElementById('booking-list');
    list.innerHTML = '<div class="text-center mt-10 text-gray-400"><i class="fas fa-circle-notch fa-spin"></i> ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>';
    apiCall('getCustomers', { limit: 50 }, (res) => {
        if (res.data.length === 0) { list.innerHTML = '<div class="text-center mt-10 text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</div>'; return; }
        list.innerHTML = `<div class="flex justify-between items-center mb-4"><h4 class="font-bold text-gray-700">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h4></div><div id="customers-list" class="space-y-3"></div>`;
        renderCustomersList(res.data);
    });
}

function renderCustomersList(customers) {
    const container = document.getElementById('customers-list');
    container.innerHTML = '';
    customers.forEach(c => {
        const item = document.createElement('div');
        item.className = 'bg-white p-4 rounded-xl shadow-sm border border-gray-100 cursor-pointer hover:shadow-md transition';
        item.onclick = () => showCustomerDetail(c.id);
        item.innerHTML = `
            <div class="flex justify-between items-start">
                <div><div class="font-bold text-gray-800">${c.name}</div><div class="text-sm text-gray-500">${c.phone}</div></div>
                <div class="text-right"><div class="text-xs text-gray-400">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</div><div class="font-bold text-rose-500">${c.totalVisits} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div></div>
            </div>
        `;
        container.appendChild(item);
    });
}

function showCustomerDetail(customerId) {
    apiCall('getCustomerProfile', { customerId: customerId }, (res) => {
        const c = res.data;
        const content = document.getElementById('customer-detail-content');
        content.innerHTML = `
            <div class="text-center mb-4">
                <div class="w-20 h-20 bg-rose-100 rounded-full flex items-center justify-center mx-auto mb-2"><i class="fas fa-user text-3xl text-rose-400"></i></div>
                <h4 class="font-bold text-lg">${c.name}</h4>
                <p class="text-gray-500 text-sm">${c.phone}</p>
            </div>
            <div class="bg-gray-50 rounded-xl p-4 space-y-3">
                <div><label class="text-xs text-gray-400">‡∏™‡∏†‡∏≤‡∏û‡∏ú‡∏°</label><p class="font-medium">${c.hairType || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</p></div>
                ${c.allergies ? `<div class="bg-red-50 p-3 rounded-lg"><label class="text-xs text-red-400"><i class="fas fa-exclamation-triangle mr-1"></i>‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ</label><p class="text-red-600 text-sm">${c.allergies}</p></div>` : ''}
                <div><label class="text-xs text-gray-400">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</label><p class="text-sm">${c.history || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}</p></div>
            </div>
            <div class="flex gap-2 mt-4">
                <div class="flex-1 bg-rose-50 p-3 rounded-xl text-center"><div class="text-2xl font-bold text-rose-500">${c.totalVisits}</div><div class="text-xs text-gray-500">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏≤</div></div>
                <div class="flex-1 bg-green-50 p-3 rounded-xl text-center"><div class="text-2xl font-bold text-green-500">‡∏ø${(c.totalSpent || 0).toLocaleString()}</div><div class="text-xs text-gray-500">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</div></div>
            </div>
        `;
        document.getElementById('customer-modal').classList.remove('hidden');
    });
}

// Reports
function showReportsPage() {
    document.getElementById('reports-modal').classList.remove('hidden');
    loadRevenueReport('today');
}

function loadRevenueReport(period) {
    let startDate, endDate;
    const today = new Date().toISOString().split('T')[0];
    
    if (period === 'today') { startDate = today; endDate = today; }
    else if (period === 'week') { startDate = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]; endDate = today; }
    else { startDate = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]; endDate = today; }
    
    apiCall('getRevenueReport', { startDate, endDate, groupBy: 'day' }, (res) => {
        const chartDiv = document.getElementById('revenue-chart');
        const summaryDiv = document.getElementById('revenue-summary');
        
        if (res.data.length === 0) { chartDiv.innerHTML = '<p class="text-gray-400 text-sm">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>'; summaryDiv.innerHTML = ''; return; }
        
        let maxRevenue = Math.max(...res.data.map(d => d.revenue));
        let chartHtml = '<div class="flex items-end justify-between h-full px-2 gap-1">';
        res.data.forEach(d => {
            const height = maxRevenue > 0 ? (d.revenue / maxRevenue * 100) : 0;
            chartHtml += `<div class="flex-1 flex flex-col items-center"><div class="w-full bg-rose-400 rounded-t" style="height: ${height}%"></div><div class="text-[10px] text-gray-500 mt-1">${d.date.substring(5)}</div></div>`;
        });
        chartHtml += '</div>';
        chartDiv.innerHTML = chartHtml;
        
        const totalRevenue = res.data.reduce((sum, d) => sum + d.revenue, 0);
        const totalCount = res.data.reduce((sum, d) => sum + d.count, 0);
        summaryDiv.innerHTML = `
            <div class="bg-gray-50 p-3 rounded-lg"><div class="flex justify-between items-center"><span class="text-sm text-gray-600">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°</span><span class="text-lg font-bold text-rose-500">‡∏ø${totalRevenue.toLocaleString()}</span></div></div>
            <div class="bg-gray-50 p-3 rounded-lg"><div class="flex justify-between items-center"><span class="text-sm text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span><span class="text-lg font-bold text-blue-500">${totalCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span></div></div>
        `;
    });
}

function buildCalendarLink(service, date, time, orderId, phone, price) {
    const timeParts = time.split(':');
    const startHour = timeParts[0].padStart(2, '0');
    const startMin = (timeParts[1] || '00').padStart(2, '0');
    const dateClean = date.replace(/-/g, '');
    const startStr = `${dateClean}T${startHour}${startMin}00`;
    const endH = String(parseInt(startHour) + 1).padStart(2, '0');
    const endStr = `${dateClean}T${endH}${startMin}00`;
    const title = encodeURIComponent(`üíÖ GY-Nail: ${service}`);
    const details = encodeURIComponent(`‡∏£‡∏´‡∏±‡∏™‡∏à‡∏≠‡∏á: ${orderId}\n‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£: ${service}${phone ? '\n‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: ' + phone : ''}\n‡∏£‡∏≤‡∏Ñ‡∏≤: ${price} ‡∏ö‡∏≤‡∏ó`);
    const location = encodeURIComponent('GY-Nail Shop');
    return `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${title}&dates=${startStr}/${endStr}&details=${details}&location=${location}&ctz=Asia/Bangkok`;
}

function showPriceList() {
    let html = '<div class="text-left text-sm space-y-2 text-gray-600 max-h-[60vh] overflow-y-auto pr-2">';
    html += `<div class="border-b pb-1 mb-1 font-bold text-rose-500 sticky top-0 bg-white">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å</div><ul class="list-disc pl-4 mb-3">`;
    menuData.services.forEach(s => html += `<li>${s.name}: ${s.price}.-</li>`);
    html += `</ul>`;
    html += `<div class="border-b pb-1 mb-1 font-bold text-rose-500 sticky top-0 bg-white">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°</div><ul class="list-disc pl-4 mb-3">`;
    menuData.addons.forEach(a => html += `<li>${a.name}: +${a.price}.-</li>`);
    html += `</ul></div>`;
    Swal.fire({ title: '‡πÄ‡∏£‡∏ó‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£', html: html, confirmButtonColor: '#f43f5e' });
}

// ============================================
// AI NAIL CONSULTANT
// ============================================

let aiChatOpen = false;
let aiUnreadCount = 0;
let aiBubbleDragging = false;
let aiBubbleStartX = 0, aiBubbleStartY = 0, aiBubbleOrigX = 0, aiBubbleOrigY = 0;
let aiBubbleMoved = false;

function toggleAIChat() {
    if (aiBubbleMoved) return;
    const panel = document.getElementById('ai-panel');
    aiChatOpen = !aiChatOpen;
    if (aiChatOpen) {
        panel.classList.remove('hidden');
        aiUnreadCount = 0;
        document.getElementById('ai-badge').classList.add('hidden');
        const container = document.getElementById('ai-chat-container');
        container.scrollTop = container.scrollHeight;
        setTimeout(() => document.getElementById('ai-input').focus(), 100);
    } else {
        panel.classList.add('hidden');
    }
}

function addAIUnread() {
    if (!aiChatOpen) {
        aiUnreadCount++;
        const badge = document.getElementById('ai-badge');
        const count = document.getElementById('ai-badge-count');
        count.textContent = aiUnreadCount > 9 ? '9+' : aiUnreadCount;
        badge.classList.remove('hidden');
    }
}

function aiBubbleTouchStart(e) {
    const touch = e.touches[0];
    const bubble = document.getElementById('ai-bubble');
    aiBubbleDragging = true;
    aiBubbleMoved = false;
    aiBubbleStartX = touch.clientX;
    aiBubbleStartY = touch.clientY;
    aiBubbleOrigX = bubble.offsetLeft;
    aiBubbleOrigY = bubble.offsetTop;
    bubble.classList.add('dragging');
    bubble.classList.remove('snapping');
}

function aiBubbleTouchMove(e) {
    if (!aiBubbleDragging) return;
    e.preventDefault();
    const touch = e.touches[0];
    const dx = touch.clientX - aiBubbleStartX;
    const dy = touch.clientY - aiBubbleStartY;
    if (Math.abs(dx) > 5 || Math.abs(dy) > 5) aiBubbleMoved = true;
    const bubble = document.getElementById('ai-bubble');
    const newX = Math.max(0, Math.min(window.innerWidth - 70, aiBubbleOrigX + dx));
    const newY = Math.max(0, Math.min(window.innerHeight - 70, aiBubbleOrigY + dy));
    bubble.style.left = newX + 'px';
    bubble.style.top = newY + 'px';
    bubble.style.right = 'auto';
    bubble.style.bottom = 'auto';
}

function aiBubbleTouchEnd(e) {
    aiBubbleDragging = false;
    const bubble = document.getElementById('ai-bubble');
    bubble.classList.remove('dragging');
    if (aiBubbleMoved) snapBubbleToEdge(bubble);
    setTimeout(() => { aiBubbleMoved = false; }, 50);
}

function aiBubbleMouseDown(e) {
    if (e.button !== 0) return;
    const bubble = document.getElementById('ai-bubble');
    aiBubbleDragging = true;
    aiBubbleMoved = false;
    aiBubbleStartX = e.clientX;
    aiBubbleStartY = e.clientY;
    aiBubbleOrigX = bubble.offsetLeft;
    aiBubbleOrigY = bubble.offsetTop;
    bubble.classList.add('dragging');
    bubble.classList.remove('snapping');

    const onMove = (ev) => {
        if (!aiBubbleDragging) return;
        const dx = ev.clientX - aiBubbleStartX;
        const dy = ev.clientY - aiBubbleStartY;
        if (Math.abs(dx) > 5 || Math.abs(dy) > 5) aiBubbleMoved = true;
        const newX = Math.max(0, Math.min(window.innerWidth - 70, aiBubbleOrigX + dx));
        const newY = Math.max(0, Math.min(window.innerHeight - 70, aiBubbleOrigY + dy));
        bubble.style.left = newX + 'px';
        bubble.style.top = newY + 'px';
        bubble.style.right = 'auto';
        bubble.style.bottom = 'auto';
    };
    const onUp = () => {
        aiBubbleDragging = false;
        bubble.classList.remove('dragging');
        document.removeEventListener('mousemove', onMove);
        document.removeEventListener('mouseup', onUp);
        if (aiBubbleMoved) snapBubbleToEdge(bubble);
        setTimeout(() => { aiBubbleMoved = false; }, 50);
    };
    document.addEventListener('mousemove', onMove);
    document.addEventListener('mouseup', onUp);
}

function snapBubbleToEdge(bubble) {
    bubble.classList.add('snapping');
    const rect = bubble.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    if (centerX < window.innerWidth / 2) {
        bubble.style.left = '10px';
        bubble.style.right = 'auto';
    } else {
        bubble.style.left = 'auto';
        bubble.style.right = '10px';
    }
}

let aiContext = { nailCondition: '', preferredStyle: '' };

function setAIContext(type) {
    const input = document.getElementById('ai-input');
    if (type === 'dry') {
        aiContext.nailCondition = '‡πÅ‡∏´‡πâ‡∏á/‡πÄ‡∏õ‡∏£‡∏≤‡∏∞';
        input.value = '‡πÄ‡∏•‡πá‡∏ö‡πÅ‡∏´‡πâ‡∏á‡πÄ‡∏õ‡∏£‡∏≤‡∏∞‡∏°‡∏≤‡∏Å ‡∏î‡∏π‡πÅ‡∏•‡∏¢‡∏±‡∏á‡πÑ‡∏á‡∏î‡∏µ‡∏Ñ‡∏∞';
    } else if (type === 'design') {
        aiContext.preferredStyle = 'Minimal';
        input.value = '‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏•‡∏≤‡∏¢‡πÄ‡∏•‡πá‡∏ö‡πÅ‡∏ö‡∏ö Minimal ‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏Ñ‡πà‡∏∞';
    } else if (type === 'care') {
        input.value = '‡∏î‡∏π‡πÅ‡∏•‡πÄ‡∏•‡πá‡∏ö‡∏¢‡∏±‡∏á‡πÑ‡∏á‡πÉ‡∏´‡πâ‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á‡∏Ñ‡∏∞';
    }
    input.focus();
}

function sendAIMessage() {
    const input = document.getElementById('ai-input');
    const message = input.value.trim();
    if (!message) return;
    
    // Add user message to chat
    addMessageToChat('user', message);
    input.value = '';
    
    // Show typing indicator
    const typingId = showTypingIndicator();
    
    // Call AI API
    apiCall('getAIAdvice', {
        question: message,
        nailCondition: aiContext.nailCondition,
        preferredStyle: aiContext.preferredStyle
    }, (res) => {
        removeTypingIndicator(typingId);
        if (res.status === 'success') {
            addMessageToChat('ai', res.data.advice);
            addAIUnread();
        } else {
            addMessageToChat('ai', '‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏∞ ‡∏ô‡πâ‡∏≠‡∏á‡∏¢‡∏∏‡πâ‡∏¢‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ‡∏•‡∏≠‡∏á‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏∞‡∏Ñ‡∏∞');
            addAIUnread();
        }
    }, () => {
        removeTypingIndicator(typingId);
        addMessageToChat('ai', '‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢‡∏Ñ‡πà‡∏∞ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏∞‡∏Ñ‡∏∞');
        addAIUnread();
    });
}

function addMessageToChat(sender, message) {
    const container = document.getElementById('ai-chat-container');
    const isAI = sender === 'ai';
    
    const html = `
        <div class="flex gap-3 ${isAI ? '' : 'flex-row-reverse'}">
            <div class="w-8 h-8 ${isAI ? 'bg-rose-500' : 'bg-gray-400'} rounded-full flex items-center justify-center flex-shrink-0">
                <i class="fas ${isAI ? 'fa-robot' : 'fa-user'} text-white text-xs"></i>
            </div>
            <div class="${isAI ? 'bg-white' : 'bg-rose-100'} p-3 rounded-2xl ${isAI ? 'rounded-tl-none' : 'rounded-tr-none'} shadow-sm max-w-[80%]">
                <p class="text-sm text-gray-700 whitespace-pre-line">${message}</p>
            </div>
        </div>
    `;
    
    container.insertAdjacentHTML('beforeend', html);
    container.scrollTop = container.scrollHeight;
}

function showTypingIndicator() {
    const container = document.getElementById('ai-chat-container');
    const id = 'typing-' + Date.now();
    const html = `
        <div id="${id}" class="flex gap-3">
            <div class="w-8 h-8 bg-rose-500 rounded-full flex items-center justify-center flex-shrink-0">
                <i class="fas fa-robot text-white text-xs"></i>
            </div>
            <div class="bg-white p-3 rounded-2xl rounded-tl-none shadow-sm">
                <div class="flex gap-1">
                    <div class="w-2 h-2 bg-gray-300 rounded-full animate-bounce"></div>
                    <div class="w-2 h-2 bg-gray-300 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                    <div class="w-2 h-2 bg-gray-300 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                </div>
            </div>
        </div>
    `;
    container.insertAdjacentHTML('beforeend', html);
    container.scrollTop = container.scrollHeight;
    return id;
}

function removeTypingIndicator(id) {
    const el = document.getElementById(id);
    if (el) el.remove();
}

// ============================================
// REVIEWS SYSTEM
// ============================================

let currentRating = 0;

function showReviews() {
    document.getElementById('reviews-modal').classList.remove('hidden');
    loadReviews();
}

function loadReviews() {
    apiCall('getReviews', { status: 'approved', limit: 10 }, (res) => {
        if (res.status === 'success') {
            // Update summary
            document.getElementById('avg-rating').textContent = res.summary.average;
            document.getElementById('total-reviews').textContent = res.summary.total;
            
            // Render stars
            const avgStars = Math.round(res.summary.average);
            let starsHtml = '';
            for (let i = 1; i <= 5; i++) {
                starsHtml += `<i class="fas fa-star ${i <= avgStars ? 'text-yellow-400' : 'text-gray-300'}"></i>`;
            }
            document.getElementById('avg-stars').innerHTML = starsHtml;
            
            // Render reviews
            const container = document.getElementById('reviews-list');
            if (res.data.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</p>';
                return;
            }
            
            container.innerHTML = res.data.map(r => {
                let stars = '';
                for (let i = 1; i <= 5; i++) {
                    stars += `<i class="fas fa-star ${i <= r.rating ? 'text-yellow-400' : 'text-gray-200'} text-xs"></i>`;
                }
                const date = new Date(r.date).toLocaleDateString('th-TH');
                return `
                    <div class="bg-gray-50 p-3 rounded-xl">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <div class="font-medium text-sm">${r.customerName}</div>
                                <div class="flex gap-0.5 mt-0.5">${stars}</div>
                            </div>
                            <span class="text-xs text-gray-400">${date}</span>
                        </div>
                        <p class="text-sm text-gray-600">${r.review || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô'}</p>
                    </div>
                `;
            }).join('');
        }
    });
}

function showSubmitReview() {
    document.getElementById('submit-review-modal').classList.remove('hidden');
}

function setRating(rating) {
    currentRating = rating;
    document.getElementById('review-rating').value = rating;
    document.querySelectorAll('.star-btn').forEach(btn => {
        const btnRating = parseInt(btn.dataset.rating);
        if (btnRating <= rating) {
            btn.classList.remove('text-gray-300');
            btn.classList.add('text-yellow-400');
        } else {
            btn.classList.remove('text-yellow-400');
            btn.classList.add('text-gray-300');
        }
    });
}

function submitReview() {
    const orderId = document.getElementById('review-order-id').value.trim();
    const rating = parseInt(document.getElementById('review-rating').value);
    const review = document.getElementById('review-text').value.trim();
    const imageFile = document.getElementById('review-image').files[0];
    
    if (!orderId) return Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á', 'warning');
    if (rating === 0) return Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô', 'warning');
    
    const doSubmit = (imageUrl) => {
        apiCall('submitReview', { orderId, rating, review, customerName: '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤', imageUrl: imageUrl || '' }, (res) => {
            if (res.status === 'success') {
                Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏Ñ‡πà‡∏∞', 'success');
                closeModal('submit-review-modal');
                document.getElementById('review-order-id').value = '';
                document.getElementById('review-text').value = '';
                document.getElementById('review-image').value = '';
                setRating(0);
            } else {
                Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', res.message, 'warning');
            }
        });
    };
    
    if (imageFile) {
        const reader = new FileReader();
        reader.onload = function(e) {
            fetch(`${API_URL}?action=uploadImage`, {
                method: "POST",
                body: JSON.stringify({
                    base64: e.target.result,
                    fileName: imageFile.name,
                    mimeType: imageFile.type,
                    folder: 'REVIEWS',
                    orderId: orderId
                }),
                redirect: "follow",
                mode: "no-cors"
            }).then(() => {
                setTimeout(() => doSubmit('uploaded'), 2000);
            }).catch(() => doSubmit(''));
        };
        reader.readAsDataURL(imageFile);
    } else {
        doSubmit('');
    }
}

function showReviewManagement() {
    // For admin - load all reviews including pending
    apiCall('getReviews', { status: 'all', limit: 50 }, (res) => {
        const list = document.getElementById('booking-list');
        if (res.data.length === 0) {
            list.innerHTML = '<div class="text-center mt-10 text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</div>';
            return;
        }
        
        list.innerHTML = '<h4 class="font-bold text-gray-700 mb-3">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡∏ß‡∏¥‡∏ß (' + res.data.length + ')</h4>';
        
        res.data.forEach(r => {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                stars += `<i class="fas fa-star ${i <= r.rating ? 'text-yellow-400' : 'text-gray-200'} text-xs"></i>`;
            }
            const statusColor = r.status === 'approved' ? 'text-green-500' : (r.status === 'pending' ? 'text-yellow-500' : 'text-red-500');
            
            const item = document.createElement('div');
            item.className = 'bg-white p-4 rounded-xl shadow-sm border border-gray-100';
            item.innerHTML = `
                <div class="flex justify-between items-start mb-2">
                    <div>
                        <div class="font-bold text-gray-800">${r.customerName}</div>
                        <div class="flex gap-0.5 mt-0.5">${stars}</div>
                    </div>
                    <span class="text-xs font-bold ${statusColor}">${r.status}</span>
                </div>
                <p class="text-sm text-gray-600 mb-3">${r.review || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô'}</p>
                ${r.status === 'pending' ? `
                    <div class="flex gap-2">
                        <button onclick="approveReview('${r.orderId}')" class="flex-1 py-1.5 text-xs bg-green-50 text-green-600 rounded">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                        <button onclick="rejectReview('${r.orderId}')" class="flex-1 py-1.5 text-xs bg-red-50 text-red-600 rounded">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button>
                    </div>
                ` : ''}
            `;
            list.appendChild(item);
        });
    });
}

function approveReview(orderId) {
    apiCall('updateReviewStatus', { orderId, status: 'approved' }, () => {
        Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
        showReviewManagement();
    });
}

function rejectReview(orderId) {
    apiCall('updateReviewStatus', { orderId, status: 'rejected' }, () => {
        showReviewManagement();
    });
}

// ============================================
// PORTFOLIO & DRIVE GALLERY
// ============================================

let isAdminPortfolio = false;

function showPortfolioGallery() {
    isAdminPortfolio = false;
    document.getElementById('portfolio-upload-section').classList.add('hidden');
    document.getElementById('portfolio-modal').classList.remove('hidden');
    loadPortfolioImages();
}

function showPortfolioManager() {
    isAdminPortfolio = true;
    document.getElementById('portfolio-upload-section').classList.remove('hidden');
    document.getElementById('portfolio-modal').classList.remove('hidden');
    loadPortfolioImages();
}

function loadPortfolioImages() {
    const grid = document.getElementById('portfolio-grid');
    grid.innerHTML = '<div class="text-center text-gray-400 py-10"><i class="fas fa-circle-notch fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>';
    
    apiCall('getPortfolio', {}, (res) => {
        if (res.status === 'success') {
            if (res.data.length === 0) {
                grid.innerHTML = '<div class="text-center text-gray-400 py-10"><i class="fas fa-images text-4xl mb-3 block"></i>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏ú‡∏•‡∏á‡∏≤‡∏ô</div>';
                return;
            }
            grid.innerHTML = '<div class="grid grid-cols-2 sm:grid-cols-3 gap-3">' +
                res.data.map(p => `
                    <div class="relative group rounded-xl overflow-hidden shadow-sm border border-gray-100">
                        <img src="${p.thumb}" class="w-full aspect-square object-cover cursor-pointer hover:scale-105 transition" 
                             onclick="document.getElementById('preview-image').src='${p.url}'; document.getElementById('image-preview-modal').classList.remove('hidden');"
                             onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23f3f4f6%22 width=%22100%22 height=%22100%22/><text x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%239ca3af%22 font-size=%2214%22>No Image</text></svg>'">
                        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2">
                            <p class="text-white text-xs font-medium truncate">${p.caption || ''}</p>
                            ${p.category ? `<span class="text-[10px] bg-white/30 text-white px-1.5 py-0.5 rounded-full">${p.category}</span>` : ''}
                        </div>
                        ${isAdminPortfolio ? `<button onclick="event.stopPropagation(); deletePortfolioImage('${p.id}')" class="absolute top-2 right-2 w-7 h-7 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition shadow-lg"><i class="fas fa-trash text-xs"></i></button>` : ''}
                    </div>
                `).join('') + '</div>';
        }
    });
}

function uploadPortfolioImage() {
    const fileInput = document.getElementById('portfolio-file');
    const caption = document.getElementById('portfolio-caption').value;
    const category = document.getElementById('portfolio-category').value;
    
    if (!fileInput.files[0]) return Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û', 'warning');
    if (fileInput.files[0].size > 5 * 1024 * 1024) return Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB', 'warning');
    
    const btn = document.getElementById('upload-btn');
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-circle-notch fa-spin mr-1"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î...';
    
    const reader = new FileReader();
    reader.onload = function(e) {
        const payload = {
            base64: e.target.result,
            fileName: fileInput.files[0].name,
            mimeType: fileInput.files[0].type,
            folder: 'PORTFOLIO',
            caption: caption,
            category: category
        };
        
        fetch(`${API_URL}?action=uploadImage`, {
            method: "POST",
            body: JSON.stringify(payload),
            redirect: "follow",
            mode: "no-cors"
        }).then(() => {
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-upload mr-1"></i> ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î';
            Swal.fire({ icon: 'success', title: '‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', text: '‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà ‡∏£‡∏π‡∏õ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...', timer: 2000, showConfirmButton: false });
            fileInput.value = '';
            document.getElementById('portfolio-caption').value = '';
            setTimeout(() => loadPortfolioImages(), 3000);
        }).catch(() => {
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-upload mr-1"></i> ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î';
            Swal.fire('Error', '‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà', 'error');
        });
    };
    reader.readAsDataURL(fileInput.files[0]);
}

function deletePortfolioImage(fileId) {
    if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏ô‡∏µ‡πâ?')) return;
    apiCall('deleteImage', { fileId: fileId }, (res) => {
        if (res.status === 'success') loadPortfolioImages();
        else Swal.fire('Error', res.message, 'error');
    });
}

function openDriveFolder() {
    apiCall('getGalleryFolderInfo', {}, (res) => {
        if (res.status === 'success') window.open(res.folderUrl, '_blank');
        else Swal.fire('Error', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î Drive ‡πÑ‡∏î‡πâ', 'error');
    });
}

// ============================================
// CONTACT CHANNELS
// ============================================

let contactMenuOpen = false;

function toggleContactMenu() {
    const menu = document.getElementById('contact-menu');
    const bubble = document.getElementById('contact-bubble').querySelector('div:first-child');
    const links = menu.querySelectorAll('a');
    contactMenuOpen = !contactMenuOpen;
    
    if (contactMenuOpen) {
        menu.classList.remove('hidden');
        bubble.style.transform = 'rotate(0deg)';
        links.forEach((link, i) => {
            link.style.animation = 'none';
            link.offsetHeight;
            link.style.animation = `contactPop 0.3s ease forwards ${i * 0.08}s`;
        });
    } else {
        menu.classList.add('hidden');
        bubble.style.transform = 'rotate(-90deg)';
    }
}

function loadContactChannels() {
    let channels = {};
    try { 
        if (typeof settings.contactChannels === 'string') {
            channels = JSON.parse(settings.contactChannels || '{}'); 
        } else {
            channels = settings.contactChannels || {};
        }
    } catch(e) { console.log('Error parsing contact channels:', e); }
    
    const fbLink = document.getElementById('contact-facebook');
    const ttLink = document.getElementById('contact-tiktok');
    const phLink = document.getElementById('contact-phone');
    const lineLink = document.getElementById('contact-line');

    if(channels.facebook) { fbLink.href = channels.facebook; fbLink.classList.remove('hidden'); } else { fbLink.classList.add('hidden'); }
    if(channels.tiktok) { ttLink.href = channels.tiktok; ttLink.classList.remove('hidden'); } else { ttLink.classList.add('hidden'); }
    if(channels.phone) { phLink.href = 'tel:' + channels.phone; phLink.classList.remove('hidden'); } else { phLink.classList.add('hidden'); }
    
    if(settings.lineUrl) { lineLink.href = settings.lineUrl; lineLink.classList.remove('hidden'); }
    else if(settings.lineId) { lineLink.href = 'https://line.me/ti/p/~' + settings.lineId; lineLink.classList.remove('hidden'); }
}

// ============================================
// SNOWFALL EFFECT
// ============================================

let snowCanvas, snowCtx;
let snowflakes = [];
let snowAnimationId;

function initSnowfall() {
    snowCanvas = document.getElementById('snowCanvas');
    if (!snowCanvas) return;
    snowCtx = snowCanvas.getContext('2d');
    if (!snowCtx) return;
    resizeSnowCanvas();
    window.addEventListener('resize', resizeSnowCanvas);
    createSnowflakes();
    animateSnow();
}

function resizeSnowCanvas() {
    if (!snowCanvas) return;
    snowCanvas.width = window.innerWidth;
    snowCanvas.height = window.innerHeight;
}

function createSnowflakes() {
    snowflakes = [];
    const flakeCount = Math.floor(window.innerWidth / 8);
    for (let i = 0; i < flakeCount; i++) {
        snowflakes.push({
            x: Math.random() * snowCanvas.width,
            y: Math.random() * snowCanvas.height,
            r: Math.random() * 3 + 1,
            d: Math.random() * flakeCount,
            speed: Math.random() * 1 + 0.5
        });
    }
}

function animateSnow() {
    snowCtx.clearRect(0, 0, snowCanvas.width, snowCanvas.height);
    snowCtx.fillStyle = 'rgba(255, 255, 255, 0.8)';
    snowCtx.beginPath();
    
    for (let i = 0; i < snowflakes.length; i++) {
        const flake = snowflakes[i];
        snowCtx.moveTo(flake.x, flake.y);
        snowCtx.arc(flake.x, flake.y, flake.r, 0, Math.PI * 2, true);
    }
    snowCtx.fill();
    moveSnowflakes();
    snowAnimationId = requestAnimationFrame(animateSnow);
}

function moveSnowflakes() {
    for (let i = 0; i < snowflakes.length; i++) {
        const flake = snowflakes[i];
        flake.y += flake.speed;
        flake.x += Math.sin(flake.d) * 0.5;
        
        if (flake.y > snowCanvas.height) {
            flake.y = -10;
            flake.x = Math.random() * snowCanvas.width;
        }
        if (flake.x > snowCanvas.width) flake.x = 0;
        if (flake.x < 0) flake.x = snowCanvas.width;
        flake.d += 0.01;
    }
}

function stopSnowfall() {
    if (snowAnimationId) {
        cancelAnimationFrame(snowAnimationId);
        snowCtx.clearRect(0, 0, snowCanvas.width, snowCanvas.height);
    }
}
</script>
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // Custom Icons
        const Icons = {
            BarChart: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="Êµ∏9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>,
            User: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>,
            Scissors: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M7 11.5V14m0-2.5v-6a1.5 1.5 0 113 0m-3 6a3 3 0 11-6 0 3 3 0 016 0zm11 2.5V14m0-2.5v-6a1.5 1.5 0 10-3 0m3 6a3 3 0 10 6 0 3 3 0 00-6 0z" /></svg>,
            Calendar: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>,
            Check: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 13l4 4L19 7" /></svg>,
            X: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" /></svg>
        };

        const AdminDashboard = () => {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [password, setPassword] = useState('');
            const [loading, setLoading] = useState(false);
            const [data, setData] = useState({ bookings: [], settings: {} });
            const [stats, setStats] = useState(null);
            const [shopOpen, setShopOpen] = useState(true);
            const [view, setView] = useState('dashboard'); // dashboard, settings
            const [editSettings, setEditSettings] = useState({});

            useEffect(() => {
                if (isLoggedIn) {
                    refreshData();
                    loadShopStatus();
                }
            }, [isLoggedIn]);

            const loadShopStatus = () => {
                apiCall('getShopStatus', {}, (res) => {
                    if (res.status === 'success') {
                        setShopOpen(res.data.isOpen);
                    }
                });
            };

            const toggleShopStatus = () => {
                const nextStatus = !shopOpen;
                apiCall('setShopStatus', { isOpen: nextStatus }, (res) => {
                    if (res.status === 'success') {
                        setShopOpen(nextStatus);
                        Swal.fire({ icon: 'success', title: nextStatus ? '‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß' : '‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß', timer: 1500, showConfirmButton: false });
                    }
                });
            };

            const refreshData = async () => {
                setLoading(true);
                try {
                    googleScriptRun.getAdminData((res) => {
                        if (res.status === 'success') {
                            setData(res);
                            setEditSettings({
                                shopName: res.settings.shopName || '',
                                timeSlots: res.settings.timeSlots || '',
                                marqueeText: res.settings.marqueeText || '',
                                ...JSON.parse(res.settings.contactChannels || '{}')
                            });
                        }
                    });
                    
                    apiCall('getDashboardStats', {}, (res) => {
                        if (res.status === 'success') setStats(res.data);
                        setLoading(false);
                    });
                } catch (err) {
                    console.error(err);
                    setLoading(false);
                }
            };

            const handleSaveSettings = () => {
                const { shopName, timeSlots, marqueeText, facebook, tiktok, phone } = editSettings;
                const contactChannels = JSON.stringify({ facebook, tiktok, phone });
                
                const newSettings = { shopName, timeSlots, marqueeText, contactChannels };
                setLoading(true);
                googleScriptRun.saveSettings(newSettings, (res) => {
                    setLoading(false);
                    if (res.status === 'success') {
                        Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß', 'success');
                        refreshData();
                        setView('dashboard');
                        // Update client view
                        if (window.initSuccess) googleScriptRun.getPublicSettings(window.initSuccess);
                    }
                });
            };

            const handleLogin = () => {
                setLoading(true);
                googleScriptRun.adminLogin(password, (res) => {
                    setLoading(false);
                    if (res.status === 'success') {
                        setIsLoggedIn(true);
                        Swal.fire({ icon: 'success', title: '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö!', timer: 1500, showConfirmButton: false });
                    } else {
                        Swal.fire('Error', '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                    }
                });
            };

            const updateBooking = (row, status) => {
                if (!confirm(`‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô "${status}" ?`)) return;
                setLoading(true);
                googleScriptRun.updateBookingStatus(row, status, (res) => {
                    setLoading(false);
                    if (res.status === 'success') {
                        Swal.fire({ icon: 'success', title: '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß', timer: 1500, showConfirmButton: false });
                        refreshData();
                    }
                });
            };

            if (!isLoggedIn) {
                return (
                    <div className="max-w-md mx-auto bg-slate-900 border border-slate-800 rounded-3xl p-8 shadow-2xl text-center">
                        <div className="w-20 h-20 bg-rose-500/10 rounded-full flex items-center justify-center mx-auto mb-6">
                            <Icons.User />
                        </div>
                        <h2 className="text-2xl font-bold text-slate-100 mb-6 font-prompt">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</h2>
                        <input 
                            type="password" 
                            value={password}
                            onChange={(e) => setPassword(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                            placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" 
                            className="w-full bg-slate-800 border border-slate-700 text-slate-100 py-3 px-4 rounded-xl mb-4 text-center focus:outline-none focus:border-rose-500 transition-colors"
                        />
                        <button 
                            onClick={handleLogin}
                            disabled={loading}
                            className="w-full bg-rose-500 hover:bg-rose-600 text-white font-bold py-3 rounded-xl transition-all active:scale-95 disabled:opacity-50"
                        >
                            {loading ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...' : '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö'}
                        </button>
                    </div>
                );
            }

            return (
                <div className="space-y-6 pb-20">
                    {/* Floating Header */}
                    <div className="flex justify-between items-center bg-slate-900/90 border border-slate-800 p-4 rounded-2xl sticky top-20 z-40 backdrop-blur-md shadow-2xl">
                        <div className="flex items-center gap-3">
                            <div className="bg-rose-500 text-white p-2 rounded-xl shadow-lg shadow-rose-500/20"><Icons.BarChart /></div>
                            <div>
                                <h2 className="font-bold text-lg text-slate-100 leading-none">{view === 'dashboard' ? 'Dashboard' : 'Settings'}</h2>
                                <p className="text-[10px] text-slate-500 mt-1 uppercase tracking-widest font-bold">GY-Nail Management</p>
                            </div>
                        </div>
                        <div className="flex gap-2">
                            {view === 'dashboard' ? (
                                <button onClick={() => setView('settings')} className="p-2 text-slate-400 hover:text-rose-500 hover:bg-slate-800 rounded-xl transition-all">
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                                </button>
                            ) : (
                                <button onClick={() => setView('dashboard')} className="p-2 text-slate-400 hover:text-rose-500 hover:bg-slate-800 rounded-xl transition-all">
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
                                </button>
                            )}
                            <button onClick={() => setIsLoggedIn(false)} className="bg-slate-800 text-slate-300 p-2 rounded-xl border border-slate-700 hover:bg-rose-500/20 hover:text-rose-500 hover:border-rose-500/50 transition-all">
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>
                            </button>
                        </div>
                    </div>

                    {view === 'dashboard' ? (
                        <>
                            {/* Stats Cards */}
                            <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">
                                {[
                                    { label: '‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ', value: stats?.today?.revenue || 0, color: 'text-rose-500', bg: 'bg-rose-500/5', border: 'border-rose-500/10' },
                                    { label: '‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ', value: stats?.month?.revenue || 0, color: 'text-emerald-500', bg: 'bg-emerald-500/5', border: 'border-emerald-500/10' },
                                    { label: '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', value: stats?.total?.revenue || 0, color: 'text-sky-500', bg: 'bg-sky-500/5', border: 'border-sky-500/10' },
                                    { label: '‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', value: stats?.pending || 0, color: 'text-amber-500', bg: 'bg-amber-500/5', border: 'border-amber-500/10', prefix: '' }
                                ].map((s, i) => (
                                    <div key={i} className={`bg-slate-900 border ${s.border} p-5 rounded-3xl shadow-lg relative overflow-hidden group`}>
                                        <div className={`absolute top-0 right-0 w-16 h-16 ${s.bg} rounded-bl-full -mr-8 -mt-8 transition-transform group-hover:scale-150`}></div>
                                        <p className="text-[10px] text-slate-500 mb-1 font-bold uppercase tracking-wider">{s.label}</p>
                                        <p className={`text-2xl font-black ${s.color}`}>
                                            {s.prefix !== '' ? '‡∏ø' : ''}{s.value.toLocaleString()}
                                        </p>
                                    </div>
                                ))}
                            </div>

                            {/* Shop Status Toggle */}
                            <div className="bg-slate-900 border border-slate-800 p-5 rounded-3xl shadow-lg flex items-center justify-between">
                                <div className="flex items-center gap-4">
                                    <div className={`w-12 h-12 rounded-2xl flex items-center justify-center ${shopOpen ? 'bg-emerald-500/10 text-emerald-500' : 'bg-rose-500/10 text-rose-500'}`}>
                                        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg>
                                    </div>
                                    <div>
                                        <h3 className="font-bold text-slate-200">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏±‡∏ö‡∏à‡∏≠‡∏á</h3>
                                        <p className="text-xs text-slate-500">{shopOpen ? '‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡∏≠‡∏á‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡πÑ‡∏î‡πâ‡∏õ‡∏Å‡∏ï‡∏¥' : '‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏à‡∏≠‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß'}</p>
                                    </div>
                                </div>
                                <button 
                                    onClick={toggleShopStatus}
                                    className={`w-14 h-8 rounded-full p-1 transition-colors duration-300 focus:outline-none ${shopOpen ? 'bg-emerald-500' : 'bg-slate-700'}`}
                                >
                                    <div className={`bg-white w-6 h-6 rounded-full shadow-md transform transition-transform duration-300 ${shopOpen ? 'translate-x-6' : 'translate-x-0'}`}></div>
                                </button>
                            </div>

                            {/* Charts & Actions */}
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div className="md:col-span-2 bg-slate-900 border border-slate-800 p-6 rounded-3xl shadow-lg">
                                    <h3 className="font-bold text-slate-300 mb-8 flex items-center gap-2">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ 7 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                                    <div className="h-48 flex items-end justify-between gap-3 border-b border-slate-800/50 pb-4 px-1">
                                        {stats?.chart7Days?.map((d, i) => {
                                            const maxRev = Math.max(...stats.chart7Days.map(item => item.revenue), 1);
                                            const height = (d.revenue / maxRev) * 100;
                                            return (
                                                <div key={i} className="flex-1 flex flex-col items-center group relative h-full justify-end">
                                                    <div className="w-full bg-rose-500/10 rounded-t-xl transition-all hover:bg-rose-500 relative cursor-pointer group-hover:shadow-[0_0_20px_rgba(244,63,94,0.3)]" style={{ height: `${Math.max(8, height)}%` }}>
                                                        <div className="hidden group-hover:flex absolute -top-10 left-1/2 -translate-x-1/2 bg-slate-800 text-rose-500 text-[10px] px-3 py-1.5 rounded-lg border border-slate-700 whitespace-nowrap z-50 shadow-2xl items-center gap-1 font-black">‡∏ø{d.revenue.toLocaleString()}</div>
                                                    </div>
                                                    <span className="text-[10px] text-slate-600 mt-3 font-bold uppercase">{d.label}</span>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                                <div className="space-y-4">
                                    <button onClick={() => openServiceManager('services')} className="w-full bg-slate-900 border border-slate-800 p-4 rounded-2xl flex items-center justify-between group hover:border-rose-500/50 transition-all">
                                        <div className="flex items-center gap-3">
                                            <div className="bg-rose-500/10 text-rose-500 p-2 rounded-xl group-hover:bg-rose-500 group-hover:text-white transition-all"><Icons.Scissors /></div>
                                            <span className="text-slate-300 font-bold text-sm">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π</span>
                                        </div>
                                        <Icons.Check />
                                    </button>
                                    <button onClick={showCustomersPage} className="w-full bg-slate-900 border border-slate-800 p-4 rounded-2xl flex items-center justify-between group hover:border-sky-500/50 transition-all">
                                        <div className="flex items-center gap-3">
                                            <div className="bg-sky-500/10 text-sky-500 p-2 rounded-xl group-hover:bg-sky-500 group-hover:text-white transition-all"><Icons.User /></div>
                                            <span className="text-slate-300 font-bold text-sm">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</span>
                                        </div>
                                        <Icons.Check />
                                    </button>
                                </div>
                            </div>

                            {/* Booking List */}
                            <div className="bg-slate-900 border border-slate-800 rounded-3xl shadow-2xl overflow-hidden">
                                <div className="p-6 border-b border-slate-800 flex justify-between items-center bg-slate-800/20">
                                    <h3 className="font-bold text-slate-200 flex items-center gap-2">
                                        <span className="w-2 h-2 rounded-full bg-rose-500 animate-pulse"></span>
                                        ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                                    </h3>
                                    <button onClick={refreshData} className="text-[10px] text-rose-500 font-bold bg-rose-500/10 px-3 py-1 rounded-full border border-rose-500/20 hover:bg-rose-500 hover:text-white transition-all">REFRESH</button>
                                </div>
                                <div className="divide-y divide-slate-800/50">
                                    {data.bookings.length > 0 ? data.bookings.map((b, i) => (
                                        <div key={i} className="p-5 hover:bg-slate-800/30 transition-all group">
                                            <div className="flex justify-between items-start mb-3">
                                                <div className="flex gap-3">
                                                    <div className="w-10 h-10 bg-slate-800 rounded-2xl flex items-center justify-center text-slate-400 font-bold border border-slate-700 group-hover:border-rose-500/30 group-hover:text-rose-500 transition-all">{b.name[0]}</div>
                                                    <div>
                                                        <div className="font-black text-slate-100 group-hover:text-rose-500 transition-colors">{b.name}</div>
                                                        <div className="text-[10px] text-slate-500 font-mono tracking-tight">#{b.orderId} ‚Ä¢ {b.phone}</div>
                                                    </div>
                                                </div>
                                                <div className={`text-[9px] font-black px-3 py-1 rounded-lg border ${
                                                    b.status === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß' ? 'bg-emerald-500/10 text-emerald-500 border-emerald-500/20' :
                                                    b.status === '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' ? 'bg-rose-500/10 text-rose-500 border-rose-500/20' :
                                                    'bg-amber-500/10 text-amber-500 border-amber-500/20'
                                                }`}>{b.status}</div>
                                            </div>
                                            <div className="grid grid-cols-2 gap-4 mb-4 text-xs">
                                                <div className="bg-slate-800/40 p-3 rounded-2xl border border-slate-800 text-slate-300"><span className="text-[9px] text-slate-500 block font-bold mb-1">‡∏ß‡∏±‡∏ô/‡πÄ‡∏ß‡∏•‡∏≤</span>{b.date} ‚Ä¢ {b.time}</div>
                                                <div className="bg-slate-800/40 p-3 rounded-2xl border border-slate-800 text-slate-300"><span className="text-[9px] text-slate-500 block font-bold mb-1">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</span>{b.service}</div>
                                            </div>
                                            <div className="flex gap-2">
                                                <button onClick={() => updateBooking(b.row, '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß')} className="flex-1 py-3 bg-rose-500 hover:bg-rose-600 text-white rounded-2xl font-black text-xs transition-all active:scale-95 shadow-lg shadow-rose-500/20">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                                                <button onClick={() => updateBooking(b.row, '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å')} className="px-6 py-3 bg-slate-800 hover:bg-slate-700 text-slate-400 rounded-2xl font-bold text-xs border border-slate-700 transition-all active:scale-95">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                                            </div>
                                        </div>
                                    )) : <div className="p-10 text-center text-slate-500 font-bold">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</div>}
                                </div>
                            </div>
                        </>
                    ) : (
                        /* Settings View */
                        <div className="bg-slate-900 border border-slate-800 rounded-3xl p-6 shadow-2xl space-y-6">
                            <h3 className="text-xl font-bold text-rose-500 mb-6 flex items-center gap-2"><svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h3>
                            
                            <div className="space-y-4">
                                <div>
                                    <label className="text-[10px] text-slate-500 font-bold uppercase tracking-widest mb-2 block">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ß‡∏¥‡πà‡∏á (Marquee)</label>
                                    <input type="text" value={editSettings.marqueeText} onChange={(e) => setEditSettings({...editSettings, marqueeText: e.target.value})} placeholder="‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà GY-Nail..." className="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 text-slate-100 focus:outline-none focus:border-rose-500 transition-colors" />
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="text-[10px] text-slate-500 font-bold uppercase tracking-widest mb-2 block">Facebook URL</label>
                                        <input type="text" value={editSettings.facebook} onChange={(e) => setEditSettings({...editSettings, facebook: e.target.value})} className="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 text-slate-100 focus:outline-none focus:border-rose-500 transition-colors" />
                                    </div>
                                    <div>
                                        <label className="text-[10px] text-slate-500 font-bold uppercase tracking-widest mb-2 block">TikTok URL</label>
                                        <input type="text" value={editSettings.tiktok} onChange={(e) => setEditSettings({...editSettings, tiktok: e.target.value})} className="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 text-slate-100 focus:outline-none focus:border-rose-500 transition-colors" />
                                    </div>
                                    <div>
                                        <label className="text-[10px] text-slate-500 font-bold uppercase tracking-widest mb-2 block">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                                        <input type="text" value={editSettings.phone} onChange={(e) => setEditSettings({...editSettings, phone: e.target.value})} className="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 text-slate-100 focus:outline-none focus:border-rose-500 transition-colors" />
                                    </div>
                                    <div>
                                        <label className="text-[10px] text-slate-500 font-bold uppercase tracking-widest mb-2 block">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô</label>
                                        <input type="text" value={editSettings.shopName} onChange={(e) => setEditSettings({...editSettings, shopName: e.target.value})} className="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 text-slate-100 focus:outline-none focus:border-rose-500 transition-colors" />
                                    </div>
                                </div>
                            </div>

                            <div className="flex gap-3 pt-6 border-t border-slate-800">
                                <button onClick={() => setView('dashboard')} className="flex-1 py-3 bg-slate-800 text-slate-400 rounded-2xl font-bold hover:bg-slate-700 transition-all">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                                <button onClick={handleSaveSettings} disabled={loading} className="flex-1 py-3 bg-rose-500 text-white rounded-2xl font-black shadow-lg shadow-rose-500/20 active:scale-95 transition-all">
                                    {loading ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...' : '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤'}
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('admin-root'));
        root.render(<AdminDashboard />);
    </script>
</body>
</html>
